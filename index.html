<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>ë‰´ì›¨ì´ë¸Œ ì²­ë…„1ë¶€ ì‚¬ë‘ë°© ì¶œì„ì²´í¬</title>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  <style>
Â  Â  * { margin:0; padding:0; box-sizing:border-box; }
Â  Â  body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:#f9fafb; min-height:100vh; }
Â  Â  .hidden { display:none !important; }

Â  Â  .header { background:#fff; border-bottom:1px solid #e5e7eb; padding:1.25rem 1rem; position:sticky; top:0; z-index:100; }
Â  Â  .header-content { max-width:1200px; margin:0 auto; position:relative; }
Â  Â  h1 { font-size:1.5rem; color:#111827; }
Â  Â  .subtitle { color:#6b7280; font-size:0.9rem; font-weight:800; margin-top:0.35rem; }
Â  Â  .admin-button { position:absolute; top:0; right:0; background:#6b7280; color:#fff; padding:0.5rem 1rem; border-radius:0.85rem; border:none; cursor:pointer; font-size:0.875rem; font-weight:900; }
Â  Â  .container { max-width:1200px; margin:0 auto; padding:1.5rem 1rem; }

Â  Â  .team-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:1rem; }
Â  Â  .team-card { background:#fff; padding:1.5rem; border-radius:0.95rem; border:2px solid #e5e7eb; cursor:pointer; transition:all .2s; }
Â  Â  .team-card:hover { border-color:#2563eb; box-shadow:0 10px 15px -3px rgba(0,0,0,.1); }
Â  Â  .team-card-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; }
Â  Â  .team-number { width:2.5rem; height:2.5rem; background:#dbeafe; border-radius:0.9rem; display:flex; align-items:center; justify-content:center; color:#2563eb; font-weight:950; font-size:1rem; }
Â  Â  .team-name { font-size:1.65rem; font-weight:950; color:#111827; margin-bottom:.25rem; }
Â  Â  .team-leader { font-size:.9rem; color:#6b7280; font-weight:800; }
Â  Â  .member-count { background:#f3f4f6; padding:.25rem .75rem; border-radius:9999px; font-size:.875rem; color:#6b7280; font-weight:900; }
Â  Â  .back-button { display:flex; align-items:center; gap:.5rem; color:#6b7280; background:none; border:none; cursor:pointer; font-size:1rem; padding:.5rem .25rem; font-weight:900; }

Â  Â  .date-section { background:#fff; padding:1rem; border-radius:.95rem; border:1px solid #e5e7eb; margin-bottom:1rem; }
Â  Â  .date-label { font-size:.875rem; font-weight:950; color:#374151; margin-bottom:.5rem; }
Â  Â  .date-input { width:100%; padding:.75rem 1rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; background:#fff; }
Â  Â  .summary-box { background:#eff6ff; padding:1rem; border-radius:.95rem; border:1px solid #bfdbfe; margin-bottom:1rem; }
Â  Â  .summary-content { display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem; }
Â  Â  .summary-title { font-weight:950; color:#111827; }
Â  Â  .summary-count { font-size:1.5rem; font-weight:950; color:#2563eb; }
Â  Â  .progress-bar { background:#e5e7eb; border-radius:9999px; height:.5rem; overflow:hidden; }
Â  Â  .progress-fill { background:#2563eb; height:100%; transition:width .3s; }
Â  Â  .search-input { width:100%; padding:.65rem .9rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; margin-bottom: 1rem; }
Â  Â Â 
Â  Â  .member-list { display:grid; grid-template-columns:repeat(auto-fill, minmax(170px, 1fr)); gap:.75rem; margin-bottom:1rem; }
Â  Â  .member-item { background:#fff; padding:.9rem; border-radius:.95rem; border:2px solid #e5e7eb; transition:all .2s; }
Â  Â  .member-item.checked { background:#eff6ff; border-color:#2563eb; }
Â  Â  .member-header { display:flex; justify-content:space-between; align-items:flex-start; cursor:pointer; gap:.5rem; }
Â  Â  .member-name { font-size:1rem; font-weight:950; color:#374151; }
Â  Â  .member-meta { margin-top:.2rem; font-size:.85rem; font-weight:900; color:#6b7280; }
Â  Â  .checkbox { width:1.75rem; height:1.75rem; border-radius:9999px; border:2px solid #d1d5db; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:.1rem; }
Â  Â  .member-item.checked .checkbox { background:#2563eb; border-color:#2563eb; }
Â  Â  .checkmark { display:none; color:#fff; font-weight:950; font-size:.95rem; }
Â  Â  .member-item.checked .checkmark { display:block; }
Â  Â  .note-section { margin-top:.75rem; padding-top:.75rem; border-top:1px solid #e5e7eb; }
Â  Â  .note-input { width:100%; padding:.55rem .65rem; border:1px solid #d1d5db; border-radius:.85rem; font-size:16px; }
Â  Â  .suggestion-textarea { width:100%; padding:.75rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; min-height:90px; }
Â  Â Â 
Â  Â  .sticky-actions { position:sticky; bottom:0; background:rgba(249,250,251,.95); border-top:1px solid #e5e7eb; padding:.75rem 0 1rem 0; backdrop-filter:blur(6px); }
Â  Â  .save-button { width:100%; background:#2563eb; color:#fff; padding:.95rem; border-radius:.95rem; border:none; font-size:1.05rem; font-weight:950; cursor:pointer; }
Â  Â  .message { padding:.85rem 1rem; border-radius:.95rem; text-align:center; font-weight:950; margin-top:.75rem; }
Â  Â  .message.success { background:#f0fdf4; color:#15803d; border:1px solid #bbf7d0; }
Â  Â  .message.error { background:#fef2f2; color:#b91c1c; border:1px solid #fecaca; }
Â  Â  .message.info { background:#eff6ff; color:#1d4ed8; border:1px solid #bfdbfe; }

Â  Â  .dashboard-tabs { display:flex; gap:1rem; margin-bottom:1.25rem; border-bottom:2px solid #e5e7eb; overflow-x:auto; }
Â  Â  .tab-button { padding:.75rem 1.25rem; background:none; border:none; cursor:pointer; color:#6b7280; border-bottom:2px solid transparent; margin-bottom:-2px; font-weight:950; white-space:nowrap; }
Â  Â  .tab-button.active { color:#2563eb; border-bottom-color:#2563eb; }
Â  Â  .admin-summary { display:grid; grid-template-columns:repeat(3, 1fr); gap:.75rem; margin:1rem 0; }
Â  Â  .admin-summary-card { background:#fff; border:1px solid #e5e7eb; border-radius:.95rem; padding:1rem; }
Â  Â  .admin-summary-value { font-size:1.6rem; font-weight:950; color:#111827; }
Â  Â  .admin-summary-label { font-size:.875rem; color:#6b7280; font-weight:950; }

Â  Â  .attendance-table { background:#fff; border-radius:.95rem; border:1px solid #e5e7eb; overflow:hidden; }
Â  Â  table { width:100%; border-collapse:collapse; }
Â  Â  /* ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” í¬ê¸°/ê¸€ì”¨ í¬ê¸° ì¡°ì • */
Â  Â  th { background:#f9fafb; padding:1rem; text-align:left; font-size:.95rem; font-weight:950; border-bottom:1px solid #e5e7eb; white-space:nowrap; }
Â  Â  td { padding:1rem; border-bottom:1px solid #e5e7eb; font-size:.95rem; vertical-align:middle; }
Â  Â Â 
Â  Â  .team-row { cursor: pointer; transition: background 0.2s; }
Â  Â  .team-row:hover { background: #f3f4f6; }
Â  Â  .team-row.unsubmitted { background:#fff; opacity:0.8; }
Â  Â  .team-row.unsubmitted td { color:#6b7280; }
Â  Â  .status-badge { display:inline-block; padding:.2rem .5rem; border-radius:4px; font-size:0.75rem; font-weight:bold; }
Â  Â  .status-ok { background:#dcfce7; color:#166534; }
Â  Â  .status-no { background:#fee2e2; color:#991b1b; }

Â  Â  .detail-row td { padding: 0 !important; background: #fafafa; border-bottom: 1px solid #e5e7eb; }
Â  Â  .detail-panel { padding: 1.5rem; }
Â  Â  .detail-grid { display:grid; gap:1rem; grid-template-columns:1fr; }
Â  Â  @media (min-width:768px){ .detail-grid { grid-template-columns: 1fr 1fr; } }
Â  Â  .detail-box { background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; }
Â  Â  .detail-header { font-weight:950; color:#111827; margin-bottom:.75rem; border-bottom:1px solid #f3f4f6; padding-bottom:.5rem; }
Â  Â  .chips { display:flex; flex-wrap:wrap; gap:.5rem; }
Â  Â  .chip { padding:.3rem .7rem; border-radius:999px; font-size:.8rem; font-weight:800; background:#eff6ff; color:#1e40af; }
Â  Â  .chip.absent { background:#fef2f2; color:#991b1b; }
Â  Â  .chart-card { background:#fff; border:1px solid #e5e7eb; border-radius:.95rem; padding:1rem; margin-top:.75rem; }

Â  Â  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:999; }
Â  Â  .modal { background:#fff; width:90%; max-width:400px; padding:1.5rem; border-radius:1rem; }
Â  Â  .modal-actions { display:flex; gap:0.5rem; margin-top:1rem; }
Â  Â  .modal-btn { flex:1; padding:0.8rem; border-radius:0.5rem; border:none; font-weight:bold; cursor:pointer; }
Â  Â  .modal-btn.primary { background:#2563eb; color:#fff; }
Â  </style>
</head>

<body>
Â  <div id="homePage">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  <button type="button" class="admin-button" id="adminBtn">ê´€ë¦¬ì</button>
Â  Â  Â  Â  <h1>ë‰´ì›¨ì´ë¸Œ ì²­ë…„1ë¶€</h1>
Â  Â  Â  Â  <p class="subtitle">ì¶œì„ ì²´í¬ë¥¼ ìœ„í•´ ì‚¬ë‘ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="container">
Â  Â  Â  <div class="team-grid" id="teamGrid"></div>
Â  Â  </div>
Â  </div>

Â  <div id="attendancePage" class="hidden">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  <button type="button" class="back-button" id="teamBackBtn">â† ë’¤ë¡œê°€ê¸°</button>
Â  Â  Â  Â  <h1 id="selectedTeamName"></h1>
Â  Â  Â  Â  <p class="subtitle" id="selectedTeamLeader"></p>
Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  <div class="container">
Â  Â  Â  <div class="date-section">
Â  Â  Â  Â  <div class="date-label">ë‚ ì§œ ì„ íƒ</div>
Â  Â  Â  Â  <input type="date" class="date-input" id="dateInput" />
Â  Â  Â  </div>
Â  Â  Â  <div class="summary-box">
Â  Â  Â  Â  <div class="summary-content">
Â  Â  Â  Â  Â  <span class="summary-title">ì¶œì„ë¥ </span>
Â  Â  Â  Â  Â  <span class="summary-count" id="attendanceCount">0 / 0</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
Â  Â  Â  </div>
Â  Â  Â  <input id="memberSearch" class="search-input" placeholder="ì´ë¦„ ê²€ìƒ‰..." />
Â  Â  Â  <div class="member-list" id="memberList"></div>
Â  Â  Â  <div class="suggestion-section" style="margin-bottom:1rem;">
Â  Â  Â  Â  <div class="date-label">ê±´ì˜ì‚¬í•­ (ì„ íƒ)</div>
Â  Â  Â  Â  <textarea class="suggestion-textarea" id="suggestionInput" placeholder="ê±´ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
Â  Â  Â  </div>
Â  Â  Â  <div class="sticky-actions">
Â  Â  Â  Â  <button type="button" class="save-button" id="saveBtn">ì¶œì„ ì •ë³´ ì €ì¥</button>
Â  Â  Â  Â  <div id="messageBox" class="hidden"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="adminDashboard" class="hidden">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  <button type="button" class="back-button" id="adminBackBtn">â† í™ˆìœ¼ë¡œ</button>
Â  Â  Â  Â  <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="container">
Â  Â  Â  <div class="dashboard-tabs">
Â  Â  Â  Â  <button class="tab-button active" data-tab="stats">ì¶œì„ í˜„í™©</button>
Â  Â  Â  Â  <button class="tab-button" data-tab="notes">íŠ¹ì´ì‚¬í•­</button>
Â  Â  Â  Â  <button class="tab-button" data-tab="suggestions">ê±´ì˜ì‚¬í•­</button> <button class="tab-button" data-tab="members">ê°œì¸ë³„ ì¡°íšŒ</button>
Â  Â  Â  </div>

Â  Â  Â  <div id="adminStatsTab">
Â  Â  Â  Â  <div class="date-section">
Â  Â  Â  Â  Â  <div class="date-label">ë‚ ì§œ í™•ì¸</div>
Â  Â  Â  Â  Â  <input type="date" class="date-input" id="adminDateInput" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="admin-summary">
Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ì¶œì„</div>
Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="adminTotalPresent">0</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ê²°ì„</div>
Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="adminTotalAbsent">0</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ì¶œì„ë¥ </div>
Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="adminTotalRate">0%</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="attendance-table" id="attendanceTable"></div>
Â  Â  Â  </div>

Â  Â  Â  <div id="adminNotesTab" class="hidden">
Â  Â  Â  Â  <div class="date-section">
Â  Â  Â  Â  Â  Â <div class="date-label">ë‚ ì§œ í™•ì¸</div>
Â  Â  Â  Â  Â  Â <input type="date" class="date-input" id="adminNotesDateInput" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="attendance-table" id="notesTable" style="padding:1rem;"></div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div id="adminSuggestionsTab" class="hidden">
Â  Â  Â  Â  <div class="date-section">
Â  Â  Â  Â  Â  Â <div class="date-label">ë‚ ì§œ í™•ì¸</div>
Â  Â  Â  Â  Â  Â <input type="date" class="date-input" id="adminSuggestionsDateInput" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="attendance-table" id="suggestionsTable" style="padding:1rem;"></div>
Â  Â  Â  </div>

Â  Â  Â  <div id="adminMembersTab" class="hidden">
Â  Â  Â  Â  <div class="date-section">
Â  Â  Â  Â  Â  <div class="date-label">ê¸°ê°„ ë° ëŒ€ìƒ ì„¤ì •</div>
Â  Â  Â  Â  Â  <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
Â  Â  Â  Â  Â  Â  <input type="date" class="date-input" id="memberStartDate" />
Â  Â  Â  Â  Â  Â  <input type="date" class="date-input" id="memberEndDate" />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <select class="date-input" id="memberSelect" style="margin-bottom:0.5rem;">
Â  Â  Â  Â  Â  Â  <option value="">ì‚¬ëŒ ì„ íƒ</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  <button type="button" class="save-button" id="downloadCsvBtn" style="background:#4b5563; margin-top:0.5rem;">
Â  Â  Â  Â  Â  Â  ğŸ“¥ ê¸°ê°„ë³„ ì „ì²´ ì¶œì„ë¥  CSV ë‹¤ìš´ë¡œë“œ
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="memberResultArea" class="hidden">
Â  Â  Â  Â  Â  Â <div class="admin-summary">
Â  Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ì¶œì„ íšŸìˆ˜</div>
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="memPresent">0</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ì´ íšŸìˆ˜</div>
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="memTotal">0</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="admin-summary-card">
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-label">ì¶œì„ë¥ </div>
Â  Â  Â  Â  Â  Â  Â  <div class="admin-summary-value" id="memRate">0%</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  Â  <canvas id="memberChart" style="width:100%; height:250px;"></canvas>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="attendance-table" id="memberHistoryTable" style="margin-top:1rem;"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="passwordModal" class="modal-overlay hidden">
Â  Â  <div class="modal">
Â  Â  Â  <h3 style="margin-bottom:0.5rem; font-size:1.2rem;">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
Â  Â  Â  <p id="modalSubtitle" style="margin-bottom:1rem; color:#666; font-size:0.9rem;"></p>
Â  Â  Â  <input type="password" id="modalPassword" class="date-input" placeholder="ë¹„ë°€ë²ˆí˜¸" />
Â  Â  Â  <div id="modalError" style="color:red; font-size:0.9rem; margin-top:0.5rem;" class="hidden"></div>
Â  Â  Â  <div class="modal-actions">
Â  Â  Â  Â  <button class="modal-btn" style="background:#f3f4f6;" id="modalCancelBtn">ì·¨ì†Œ</button>
Â  Â  Â  Â  <button class="modal-btn primary" id="modalOkBtn">í™•ì¸</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzcTHwxzFUJYeIHXWebBsgOq1OXfkKAKb7VYPKXBp_V1Rddm6C100PulVq2YswoivqlbA/exec";
Â  Â  const ADMIN_PASSWORD = "newwave2026";
Â  Â Â 
Â  Â  // âš ï¸ ì¤‘ìš”: ì•„ë˜ TEAMS ë°°ì—´ì˜ members ì†ì„±ì„ ì‹¤ì œ ë°©ì› ì´ë¦„ê³¼ ë˜ë˜(cohort)ë¡œ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤!
Â  Â  // ì´ë¦„ê³¼ ë˜ë˜ëŠ” êµ¬ê¸€ ì‹œíŠ¸ì— ê¸°ë¡ë˜ëŠ” ì •ë³´ì™€ ì™„ì „íˆ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
Â  Â  const TEAMS = [
Â  Â  Â  { id: 1, name: "ê¶Œì¤€í˜• ì‚¬ë‘ë°©", leader: "ë°©ì¥: ê¶Œì¤€í˜•", members: [
Â  Â  Â  Â  {name:"í™ê¸¸ë™",cohort:"99"}, // ì˜ˆì‹œ: ì´ë¦„ê³¼ ë˜ë˜ë¥¼ ì‹¤ì œ ì •ë³´ë¡œ ìˆ˜ì •
Â  Â  Â  Â  {name:"ê¹€ì² ìˆ˜",cohort:"00"},
Â  Â  Â  Â  {name:"ë°•ì˜í¬",cohort:"97"} // í•„ìš”í•œ ë§Œí¼ ë°©ì›ì„ ì¶”ê°€í•˜ì„¸ìš”
Â  Â  Â  ]},
Â  Â  Â  { id: 2, name: "ê¹€ë‚˜ë¦¼ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ê¹€ë‚˜ë¦¼", members: [
Â  Â  Â  Â  {name:"ì´ì² ìˆ˜",cohort:"98"},
Â  Â  Â  Â  {name:"ì •ì˜í¬",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 3, name: "ë¬¸ìœ ì•ˆ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ë¬¸ìœ ì•ˆ", members: [
Â  Â  Â  Â  {name:"ë°©ì›3-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›3-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 4, name: "ë²¡ì—ìŠ¤ë” ì‚¬ë‘ë°©", leader: "ë°©ì¥: ë²¡ì—ìŠ¤ë”", members: [
Â  Â  Â  Â  {name:"ë°©ì›4-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›4-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 5, name: "ì´ì˜ˆì • ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì´ì˜ˆì •", members: [
Â  Â  Â  Â  {name:"ë°©ì›5-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›5-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 6, name: "ì´ì§€ë¹ˆ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì´ì§€ë¹ˆ", members: [
Â  Â  Â  Â  {name:"ë°©ì›6-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›6-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 7, name: "ì´í•˜ì€ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì´í•˜ì€", members: [
Â  Â  Â  Â  {name:"ë°©ì›7-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›7-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 8, name: "ì´í¬ì§„ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì´í¬ì§„", members: [
Â  Â  Â  Â  {name:"ë°©ì›8-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›8-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 9, name: "ì„ì‚¬ë‘ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì„ì‚¬ë‘", members: [
Â  Â  Â  Â  {name:"ë°©ì›9-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›9-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 10, name: "ì¥í•˜ëŠ˜ ì‚¬ë‘ë°©", leader: "ë°©ì¥: ì¥í•˜ëŠ˜", members: [
Â  Â  Â  Â  {name:"ë°©ì›10-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›10-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 11, name: "í•˜ì¬ì˜ ì‚¬ë‘ë°©", leader: "ë°©ì¥: í•˜ì¬ì˜", members: [
Â  Â  Â  Â  {name:"ë°©ì›11-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›11-2",cohort:"01"}
Â  Â  Â  ] },
Â  Â  Â  { id: 12, name: "WeeíŒ€", leader: "ë°©ì¥: ê¶Œí•˜ê²½, ìµœìˆ˜ì¸", members: [
Â  Â  Â  Â  {name:"ë°©ì›12-1",cohort:"00"},
Â  Â  Â  Â  {name:"ë°©ì›12-2",cohort:"01"}
Â  Â  Â  ] }
Â  Â  ];
Â  Â  // ì‚¬ë‘ë°©ë³„ ë¹„ë°€ë²ˆí˜¸ (ì˜ˆì‹œ: pw1111, pw2222...)
Â  Â  const TEAM_PASSWORDS = {};
Â  Â  TEAMS.forEach(t => TEAM_PASSWORDS[t.id] = "pw" + t.id + t.id + t.id + t.id);
Â  Â Â 
Â  Â  let selectedTeam = null;
Â  Â  let attendance = {};Â 
Â  Â  let memberNotes = {};
Â  Â  let adminAuthed = false;
Â  Â  let chartInstance = null;

Â  Â  // âœ… ë˜ë˜ ì •ê·œí™” í—¬í¼ í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸)
Â  Â  function normalizeCohort(value) {
Â  Â  Â  Â  const cohortStr = (value || "").toString().trim();
Â  Â  Â  Â  // ì„œë²„ì—ì„œ 0ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ë“¤ì–´ì™”ì„ ê²½ìš°, ë‹¤ì‹œ '00'ìœ¼ë¡œ ì •ê·œí™”
Â  Â  Â  Â  if (cohortStr === '0') return '00';
Â  Â  Â  Â  return cohortStr;
Â  Â  }

Â  Â  function showPage(id) {
Â  Â  Â  ["homePage","attendancePage","adminDashboard"].forEach(p => document.getElementById(p).classList.add("hidden"));
Â  Â  Â  document.getElementById(id).classList.remove("hidden");
Â  Â  }
Â  Â  function showMsg(type, text) {
Â  Â  Â  const box = document.getElementById("messageBox");
Â  Â  Â  box.className = "message " + type;
Â  Â  Â  box.textContent = text;
Â  Â  Â  box.classList.remove("hidden");
Â  Â  Â  setTimeout(() => box.classList.add("hidden"), 3000);
Â  Â  }
Â  Â  function jsonp(url, params) {
Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  const cb = "cb_" + Date.now() + Math.floor(Math.random()*1000);
Â  Â  Â  Â  params.callback = cb;
Â  Â  Â  Â  const query = Object.keys(params).map(k => encodeURIComponent(k)+"="+encodeURIComponent(params[k])).join("&");
Â  Â  Â  Â  const script = document.createElement("script");
Â  Â  Â  Â  script.src = url + "?" + query;
Â  Â  Â  Â  window[cb] = (data) => { delete window[cb]; document.body.removeChild(script); resolve(data); };
Â  Â  Â  Â  script.onerror = () => { delete window[cb]; if(script.parentNode) document.body.removeChild(script); reject("Network Error"); };
Â  Â  Â  Â  document.body.appendChild(script);
Â  Â  Â  });
Â  Â  }

Â  Â  // ì´ˆê¸°í™”
Â  Â  const today = new Date().toISOString().split("T")[0];
Â  Â  document.getElementById("dateInput").value = today;
Â  Â  document.getElementById("adminDateInput").value = today;
Â  Â  document.getElementById("adminNotesDateInput").value = today;
Â  Â  document.getElementById("adminSuggestionsDateInput").value = today; // âœ… ê±´ì˜ì‚¬í•­ íƒ­ ë‚ ì§œ ì´ˆê¸°í™”
Â  Â  const oneYearAgo = new Date(); oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
Â  Â  document.getElementById("memberStartDate").value = oneYearAgo.toISOString().split("T")[0];
Â  Â  document.getElementById("memberEndDate").value = today;
Â  Â  initTeamGrid();

Â  Â  function initTeamGrid() {
Â  Â  Â  const grid = document.getElementById("teamGrid");
Â  Â  Â  TEAMS.forEach(t => {
Â  Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  Â  card.className = "team-card";
Â  Â  Â  Â  // ë©¤ë²„ ëª©ë¡ì´ ê°ì²´ ë°°ì—´ë¡œ í†µì¼ë˜ì—ˆìœ¼ë¯€ë¡œ, .lengthëŠ” í•­ìƒ ì •í™•í•¨
Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  <div class="team-card-header"><div class="team-number">${t.id}</div><div class="member-count">${t.members.length}ëª…</div></div>
Â  Â  Â  Â  Â  <div class="team-name">${t.name}</div><div class="team-leader">${t.leader}</div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  card.onclick = () => openPasswordModal("team", t);
Â  Â  Â  Â  grid.appendChild(card);
Â  Â  Â  });
Â  Â  }

Â  Â  const modalState = { type: null, data: null };
Â  Â  function openPasswordModal(type, data) {
Â  Â  Â  modalState.type = type;Â 
Â  Â  Â  modalState.data = data;
Â  Â  Â  document.getElementById("passwordModal").classList.remove("hidden");
Â  Â  Â  document.getElementById("modalPassword").value = "";
Â  Â  Â  document.getElementById("modalError").classList.add("hidden");
Â  Â  Â  document.getElementById("modalSubtitle").textContent = type === "admin" ? "ê´€ë¦¬ì ì ‘ì†" : data.name;
Â  Â  Â  document.getElementById("modalPassword").focus();
Â  Â  }
Â  Â  document.getElementById("modalCancelBtn").onclick = () => document.getElementById("passwordModal").classList.add("hidden");
Â  Â  document.getElementById("modalOkBtn").onclick = checkPassword;
Â  Â  document.getElementById("modalPassword").onkeydown = (e) => { if(e.key==="Enter") checkPassword(); };
Â  Â  function checkPassword() {
Â  Â  Â  const input = document.getElementById("modalPassword").value;
Â  Â  Â  const err = document.getElementById("modalError");
Â  Â  Â  if (modalState.type === "admin") {
Â  Â  Â  Â  if (input === ADMIN_PASSWORD) { adminAuthed = true; document.getElementById("passwordModal").classList.add("hidden"); showAdminDashboard(); }
Â  Â  Â  Â  else { err.textContent = "ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"; err.classList.remove("hidden"); }
Â  Â  Â  } else {
Â  Â  Â  Â  if (input === TEAM_PASSWORDS[modalState.data.id]) { document.getElementById("passwordModal").classList.add("hidden"); loadTeamPage(modalState.data); }
Â  Â  Â  Â  else { err.textContent = "ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"; err.classList.remove("hidden"); }
Â  Â  Â  }
Â  Â  }

Â  Â  // ì¶œì„ì²´í¬ ë¡œì§
Â  Â  function loadTeamPage(team) {
Â  Â  Â  selectedTeam = team;
Â  Â  Â  document.getElementById("selectedTeamName").textContent = team.name;
Â  Â  Â  document.getElementById("selectedTeamLeader").textContent = team.leader;
Â  Â  Â  showPage("attendancePage");
Â  Â  Â  attendance = {}; memberNotes = {};
Â  Â  Â  const list = document.getElementById("memberList");
Â  Â  Â  list.innerHTML = "";
Â  Â  Â Â 
Â  Â  Â  // âœ… key ìƒì„± ë¡œì§: ë˜ë˜ ì •ê·œí™” ì ìš©
Â  Â  Â  team.members.forEach(m => {
Â  Â  Â  Â  const name = (m.name || "").toString().trim(); // ì´ë¦„ trim
Â  Â  Â  Â  const cohort = normalizeCohort(m.cohort); // ë˜ë˜ ì •ê·œí™”
Â  Â  Â  Â  const key = name + "||" + cohort; // ì¼ê´€ëœ í‚¤ ìƒì„±
Â  Â  Â  Â Â 
Â  Â  Â  Â  attendance[key] = false;
Â  Â  Â  Â  const el = document.createElement("div");
Â  Â  Â  Â  el.className = "member-item";
Â  Â  Â  Â  el.dataset.key = key;
Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  <div class="member-header">
Â  Â  Â  Â  Â  Â  <div><div class="member-name">${name}</div><div class="member-meta">${cohort ? cohort + " ë˜ë˜" : ""}</div></div>
Â  Â  Â  Â  Â  Â  <div class="checkbox"><span class="checkmark">âœ“</span></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="note-section"><input class="note-input" placeholder="íŠ¹ì´ì‚¬í•­" oninput="saveNote('${key}', this.value)" onclick="event.stopPropagation()"></div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  el.onclick = (e) => {
Â  Â  Â  Â  Â  if (e.target.tagName === "INPUT") return;
Â  Â  Â  Â  Â  attendance[key] = !attendance[key];
Â  Â  Â  Â  Â  el.classList.toggle("checked", attendance[key]);
Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  };
Â  Â  Â  Â  list.appendChild(el);
Â  Â  Â  });
Â  Â  Â  loadServerAttendance();
Â  Â  }
Â  Â  function saveNote(key, val) { memberNotes[key] = val; }
Â  Â  function updateUI() {
Â  Â  Â  const total = Object.keys(attendance).length;
Â  Â  Â  const present = Object.values(attendance).filter(Boolean).length;
Â  Â  Â  document.getElementById("attendanceCount").textContent = `${present} / ${total}`;
Â  Â  Â  document.getElementById("progressFill").style.width = total ? (present/total*100)+"%" : "0%";
Â  Â  }
Â  Â  async function loadServerAttendance() {
Â  Â  Â  showMsg("info", "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, {Â 
Â  Â  Â  Â  Â  action: "loadAttendance", teamId: selectedTeam.id, date: document.getElementById("dateInput").valueÂ 
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. ì´ˆê¸°í™” (í˜„ì¬ íŒ€ ëª©ë¡ì„ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ìƒíƒœë¥¼ ì´ˆê¸°í™”)
Â  Â  Â  Â  const items = document.querySelectorAll(".member-item");
Â  Â  Â  Â  items.forEach(el => {Â 
Â  Â  Â  Â  Â  Â  attendance[el.dataset.key] = false;Â 
Â  Â  Â  Â  Â  Â  el.classList.remove("checked");Â 
Â  Â  Â  Â  Â  Â  el.querySelector(".note-input").value = "";Â 
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (res.status === "success" && res.data.found) {
Â  Â  Â  Â  Â  // 2. ì„œë²„ ë°ì´í„° ì²˜ë¦¬
Â  Â  Â  Â  Â  res.data.attendance.forEach(r => {
Â  Â  Â  Â  Â  Â  // âœ… ì„œë²„ì—ì„œ ë°›ì€ ì´ë¦„ê³¼ ë˜ë˜ë¡œ í‚¤ ì¬ìƒì„± (ì •ê·œí™” ì ìš©)
Â  Â  Â  Â  Â  Â  const nameFromServer = (r.name || "").toString().trim();
Â  Â  Â  Â  Â  Â  const cohortFromServer = normalizeCohort(r.cohort); // ë˜ë˜ ì •ê·œí™”
Â  Â  Â  Â  Â  Â  const key = nameFromServer + "||" + cohortFromServer;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // í˜„ì¬ íŒ€ ëª©ë¡ì— ìˆëŠ” ë°©ì›ì¸ì§€ í™•ì¸ (keyê°€ ì¼ì¹˜í•˜ëŠ”ì§€)
Â  Â  Â  Â  Â  Â  if (attendance.hasOwnProperty(key)) {Â 
Â  Â  Â  Â  Â  Â  Â  Â attendance[key] = r.isPresent;Â 
Â  Â  Â  Â  Â  Â  Â  Â memberNotes[key] = r.note;
Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â const el = document.querySelector(`.member-item[data-key="${key}"]`);
Â  Â  Â  Â  Â  Â  Â  Â if (el) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(r.isPresent) el.classList.add("checked");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â el.querySelector(".note-input").value = r.note;Â 
Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  document.getElementById("suggestionInput").value = res.data.suggestion || "";
Â  Â  Â  Â  Â  showMsg("success", "ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  document.getElementById("suggestionInput").value = "";
Â  Â  Â  Â  Â  showMsg("info", "ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  Â  } catch(e) { console.error(e); showMsg("error", "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨"); }
Â  Â  }
Â  Â  document.getElementById("saveBtn").onclick = async () => {
Â  Â  Â  Â const btn = document.getElementById("saveBtn");
Â  Â  Â  Â btn.textContent = "ì €ì¥ ì¤‘..."; btn.disabled = true;
Â  Â  Â  Â const list = [];
Â  Â  Â  Â for(let key in attendance) {
Â  Â  Â  Â  Â const [name, cohort] = key.split("||"); // ì´ë¯¸ ì •ê·œí™”ëœ í‚¤ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì•ˆì „í•¨
Â  Â  Â  Â  Â list.push({ name, cohort, isPresent: attendance[key], note: memberNotes[key] || "" });
Â  Â  Â  Â }
Â  Â  Â  Â try {
Â  Â  Â  Â  Â await jsonp(GOOGLE_SCRIPT_URL, {
Â  Â  Â  Â  Â  Â action: "saveAttendance", teamId: selectedTeam.id, teamName: selectedTeam.name, leader: selectedTeam.leader,
Â  Â  Â  Â  Â  Â date: document.getElementById("dateInput").value, suggestion: document.getElementById("suggestionInput").value, attendance: JSON.stringify(list)
Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â showMsg("success", "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
Â  Â  Â  Â } catch(e) { showMsg("error", "ì €ì¥ ì‹¤íŒ¨"); }
Â  Â  Â  Â finally { btn.textContent = "ì¶œì„ ì •ë³´ ì €ì¥"; btn.disabled = false; }
Â  Â  };
Â  Â  document.getElementById("teamBackBtn").onclick = () => showPage("homePage");
Â  Â  document.getElementById("dateInput").onchange = loadServerAttendance;
Â  Â  document.getElementById("memberSearch").oninput = (e) => {
Â  Â  Â  const val = e.target.value.toLowerCase();
Â  Â  Â  document.querySelectorAll(".member-item").forEach(el => el.style.display = el.dataset.key.toLowerCase().includes(val) ? "" : "none");
Â  Â  };

Â  Â  // ê´€ë¦¬ì
Â  Â  document.getElementById("adminBtn").onclick = () => { adminAuthed ? showAdminDashboard() : openPasswordModal("admin"); };
Â  Â  document.getElementById("adminBackBtn").onclick = () => { adminAuthed = false; showPage("homePage"); };
Â  Â  function showAdminDashboard() { showPage("adminDashboard"); loadAdminStats(); loadMemberList(); }
Â  Â Â 
Â  Â  // âœ… íƒ­ ì „í™˜ ë¡œì§ ìˆ˜ì •
Â  Â  document.querySelectorAll(".tab-button").forEach(btn => {
Â  Â  Â  btn.onclick = () => {
Â  Â  Â  Â  document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
Â  Â  Â  Â  btn.classList.add("active");
Â  Â  Â  Â  // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¹€
Â  Â  Â  Â  ["adminStatsTab","adminNotesTab","adminSuggestionsTab","adminMembersTab"].forEach(id => document.getElementById(id).classList.add("hidden"));
Â  Â  Â  Â Â 
Â  Â  Â  Â  const targetMap = {Â 
Â  Â  Â  Â  Â  Â  "stats":"adminStatsTab",Â 
Â  Â  Â  Â  Â  Â  "notes":"adminNotesTab",Â 
Â  Â  Â  Â  Â  Â  "suggestions":"adminSuggestionsTab", 
Â  Â  Â  Â  Â  Â  "members":"adminMembersTab"Â 
Â  Â  Â  Â  };
Â  Â  Â  Â  const targetId = targetMap[btn.dataset.tab];

Â  Â  Â  Â  document.getElementById(targetId).classList.remove("hidden");
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(btn.dataset.tab === "stats") loadAdminStats();
Â  Â  Â  Â  if(btn.dataset.tab === "notes") loadAdminNotes();
Â  Â  Â  Â  if(btn.dataset.tab === "suggestions") loadAdminSuggestions();
Â  Â  Â  }
Â  Â  });

Â  Â  // ê´€ë¦¬ì: ì¶œì„í˜„í™© (ì „ì²´ ë³´ê¸° ìˆ˜ì •)
Â  Â  async function loadAdminStats() {
Â  Â  Â  const date = document.getElementById("adminDateInput").value;
Â  Â  Â  const container = document.getElementById("attendanceTable");
Â  Â  Â  container.innerHTML = "<div class='message info'>ë¡œë”© ì¤‘...</div>";
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getStatsByDate", date });
Â  Â  Â  Â  if(res.status !== "success") throw new Error();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ì´ì›</th><th>ì¶œì„</th><th>ê²°ì„</th><th>ì¶œì„ë¥ </th></tr></thead><tbody>`;
Â  Â  Â  Â  
Â  Â  Â  Â  // í†µê³„ í•©ì‚° ë³€ìˆ˜ ì´ˆê¸°í™”
Â  Â  Â  Â  let tp=0; // ì´ ì¶œì„
Â  Â  Â  Â  let tm=0; // ì „ì²´ ì´ì› (TEAMS ê¸°ì¤€)
Â  Â  Â  Â  
Â  Â  Â  Â  const submittedData = res.data.teamStats; // ì œì¶œëœ íŒ€ ë¦¬ìŠ¤íŠ¸

Â  Â  Â  Â  // ì „ì²´ TEAMS ë£¨í”„ë¥¼ ëŒë©´ì„œ ì œì¶œ/ë¯¸ì œì¶œ íŒë‹¨ ë° í†µê³„ ê³„ì‚°
Â  Â  Â  Â  TEAMS.forEach(team => {
Â  Â  Â  Â  Â  // í•´ë‹¹ íŒ€ ë°ì´í„° ì°¾ê¸°
Â  Â  Â  Â  Â  const stat = submittedData.find(s => String(s.teamId) === String(team.id));
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // ì‚¬ë‘ë°© ì´ì› (TEAMS ë°°ì—´ì— ì •ì˜ëœ ì¸ì› ìˆ˜)
Â  Â  Â  Â  Â  const totalMembers = team.members.length;Â 
Â  Â  Â  Â  Â  tm += totalMembers; // ì „ì²´ ì´ì›ì— í•©ì‚°
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (stat) {
Â  Â  Â  Â  Â  Â  // âœ… ìˆ˜ì •: ë°›ì€ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ìˆ«ìë¡œ ë³€í™˜
Â  Â  Â  Â  Â  Â  const present = Number(stat.present) || 0;
Â  Â  Â  Â  Â  Â  const absent = Number(stat.absent) || 0;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ì‹¤ì œ ê¸°ë¡ëœ ì¸ì› ìˆ˜ (ì¶œì„ + ê²°ì„) - ì´ ê°’ì´ ì´ì›ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
Â  Â  Â  Â  Â  Â  const totalRecorded = present + absent; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // âœ… ì¶œì„ë¥  ê³„ì‚°: ì¶œì„ ì¸ì› / (ì¶œì„ + ê²°ì„) * 100
Â  Â  Â  Â  Â  Â  const rate = totalRecorded ? Math.round(present/totalRecorded*100) : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tp += present; 
Â  Â  Â  Â  Â  Â  // taëŠ” ìµœì¢…ì ìœ¼ë¡œ tm - tpë¡œ ê³„ì‚°ë˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” tpë§Œ í•©ì‚°

Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  <tr class="team-row" onclick="toggleDetail(this, '${team.id}', '${date}')">
Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="status-badge status-ok">ì œì¶œ</span> ${team.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${totalRecorded}</td><td>${present}</td><td>${absent}</td><td>${rate}%</td>
Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  <tr class="detail-row hidden" id="detail-${team.id}">
Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="5"><div class="detail-panel" id="panel-${team.id}">ë¡œë”© ì¤‘...</div></td>
Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // ë¯¸ì œì¶œ
Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  <tr class="team-row unsubmitted">
Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="status-badge status-no">ë¯¸ì œì¶œ</span> ${team.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${totalMembers}</td><td>0</td><td>${totalMembers}</td><td>0%</td>
Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  html += "</tbody></table>";
Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  
Â  Â  Â  Â  // âœ… ìµœì¢… í†µê³„ ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸
Â  Â  Â  Â  const totalAbsent = tm - tp; // ì „ì²´ ê²°ì„ = ì „ì²´ ì´ì› - ì „ì²´ ì¶œì„
Â  Â  Â  Â  const totalRate = tm > 0 ? Math.round(tp / tm * 100) : 0;
Â  Â  Â  Â  
Â  Â  Â  Â  document.getElementById("adminTotalPresent").textContent = tp + "ëª…";
Â  Â  Â  Â  document.getElementById("adminTotalAbsent").textContent = totalAbsent + "ëª…";
Â  Â  Â  Â  document.getElementById("adminTotalRate").textContent = totalRate + "%";
Â  Â  Â  
Â  Â  Â  } catch(e) { 
Â  Â  Â  Â  console.error("Admin Stats Loading Error:", e);
Â  Â  Â  Â  container.innerHTML = "<div class='message error'>ë¡œë”© ì‹¤íŒ¨</div>"; 
Â  Â  Â  }
Â  Â  }
Â  Â  document.getElementById("adminDateInput").onchange = loadAdminStats;

Â  Â  async function toggleDetail(row, teamId, date) {
Â  Â  Â  Â const detailRow = document.getElementById(`detail-${teamId}`);
Â  Â  Â  Â if (!detailRow) return;
Â  Â  Â  Â const isHidden = detailRow.classList.contains("hidden");
Â  Â  Â  Â if (isHidden) {
Â  Â  Â  Â  Â detailRow.classList.remove("hidden"); row.style.background = "#eff6ff";
Â  Â  Â  Â  Â const panel = document.getElementById(`panel-${teamId}`);
Â  Â  Â  Â  Â try {
Â  Â  Â  Â  Â  Â const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "loadAttendance", teamId, date });
Â  Â  Â  Â  Â  Â if (res.status === "success" && res.data.found) {
Â  Â  Â  Â  Â  Â  Â const att = res.data.attendance;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // 1. ì¶œì„/ê²°ì„ ëª…ë‹¨
Â  Â  Â  Â  Â  Â  Â const present = att.filter(x=>x.isPresent).map(x=>`<span class="chip">${x.name}</span>`).join("");
Â  Â  Â  Â  Â  Â  Â const absent = att.filter(x=>!x.isPresent).map(x=>`<span class="chip absent">${x.name}</span>`).join("");
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // 2. íŠ¹ì´ì‚¬í•­ ëª…ë‹¨ ìƒì„± (ìš”ì²­í•˜ì‹  'ì´ë¦„ë˜ë˜: ë‚´ìš©' í˜•ì‹)
Â  Â  Â  Â  Â  Â  Â const notes = att.filter(x => x.note && x.note.trim() !== "");
Â  Â  Â  Â  Â  Â  Â let notesHtml = notes.map(n => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const cohortDisplay = n.cohort ? n.cohort : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â return `<div><strong>${n.name}${cohortDisplay}:</strong> ${n.note}</div>`;
Â  Â  Â  Â  Â  Â  Â }).join("<div style='height: 4px;'></div>"); 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // 3. íŒ¨ë„ HTML ì¬êµ¬ì„± (íŠ¹ì´ì‚¬í•­ë§Œ í‘œì‹œ)
Â  Â  Â  Â  Â  Â  Â panel.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â <div class="detail-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="detail-box"><div class="detail-header">ì¶œì„ ëª…ë‹¨ (${att.filter(x=>x.isPresent).length}ëª…)</div><div class="chips">${present || "ì—†ìŒ"}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="detail-box"><div class="detail-header">ê²°ì„ ëª…ë‹¨ (${att.filter(x=>!x.isPresent).length}ëª…)</div><div class="chips">${absent || "ì—†ìŒ"}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â <div class="detail-box" style="margin-top:1rem;"><div class="detail-header">ë°©ì›ë³„ íŠ¹ì´ì‚¬í•­ (${notes.length}ê±´)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${notesHtml || "ì—†ìŒ"}
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â <div class="detail-box" style="margin-top:1rem;"><div class="detail-header">ë°©ì¥ ê±´ì˜ì‚¬í•­</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${res.data.suggestion || "ì—†ìŒ"}
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â `;
Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â panel.innerHTML = "<div class='message error'>ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>";
Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â } catch(e) {
Â  Â  Â  Â  Â  Â console.error("Detail Load Error:", e);
Â  Â  Â  Â  Â  Â panel.innerHTML = "<div class='message error'>ìƒì„¸ ì •ë³´ ë¡œë”© ì‹¤íŒ¨</div>";
Â  Â  Â  Â  Â }
Â  Â  Â  Â } else {
Â  Â  Â  Â  Â detailRow.classList.add("hidden"); row.style.background = "";
Â  Â  Â  Â }
Â  Â  }

Â  Â  // ê´€ë¦¬ì: íŠ¹ì´ì‚¬í•­
Â  Â  async function loadAdminNotes() {
Â  Â  Â  const date = document.getElementById("adminNotesDateInput").value;
Â  Â  Â  const container = document.getElementById("notesTable");
Â  Â  Â  container.innerHTML = "<div class='message info'>ë¡œë”© ì¤‘...</div>";
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getNotesByDate", date });
Â  Â  Â  Â  if(res.status !== "success") throw new Error();
Â  Â  Â  Â  if(res.data.length === 0) { container.innerHTML = "<div class='message info'>ê¸°ë¡ëœ íŠ¹ì´ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }

Â  Â  Â  Â  let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ë°©ì›ëª…(ë˜ë˜)</th><th>ë‚´ìš©</th></tr></thead><tbody>`;
Â  Â  Â  Â  res.data.forEach(note => {
Â  Â  Â  Â  Â  html += `<tr><td>${note.teamName}</td><td>${note.name} (${note.cohort})</td><td>${note.note}</td></tr>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  html += "</tbody></table>";
Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  } catch(e) { container.innerHTML = "<div class='message error'>ë¡œë”© ì‹¤íŒ¨</div>"; }
Â  Â  }
Â  Â  document.getElementById("adminNotesDateInput").onchange = loadAdminNotes;

Â  Â  // ê´€ë¦¬ì: ê±´ì˜ì‚¬í•­
Â  Â  async function loadAdminSuggestions() {
Â  Â  Â  const date = document.getElementById("adminSuggestionsDateInput").value;
Â  Â  Â  const container = document.getElementById("suggestionsTable");
Â  Â  Â  container.innerHTML = "<div class='message info'>ë¡œë”© ì¤‘...</div>";
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getSuggestionsByDate", date });
Â  Â  Â  Â  if(res.status !== "success") throw new Error();
Â  Â  Â  Â  if(res.data.length === 0) { container.innerHTML = "<div class='message info'>ê¸°ë¡ëœ ê±´ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }

Â  Â  Â  Â  let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ê±´ì˜ì‚¬í•­</th></tr></thead><tbody>`;
Â  Â  Â  Â  res.data.forEach(sug => {
Â  Â  Â  Â  Â  html += `<tr><td>${sug.teamName}</td><td>${sug.suggestion}</td></tr>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  html += "</tbody></table>";
Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  } catch(e) { container.innerHTML = "<div class='message error'>ë¡œë”© ì‹¤íŒ¨</div>"; }
Â  Â  }
Â  Â  document.getElementById("adminSuggestionsDateInput").onchange = loadAdminSuggestions;
Â  Â  
Â  Â  // ê´€ë¦¬ì: ê°œì¸ë³„ ì¡°íšŒ
Â  Â  let allMembers = [];
Â  Â  async function loadMemberList() {
Â  Â  Â  const select = document.getElementById("memberSelect");
Â  Â  Â  select.innerHTML = "<option value=''>ë¡œë”© ì¤‘...</option>";
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getAllMembers" });
Â  Â  Â  Â  if(res.status !== "success") throw new Error();
Â  Â  Â  Â  allMembers = res.data;
Â  Â  Â  Â  select.innerHTML = "<option value=''>ì‚¬ëŒ ì„ íƒ</option>";
Â  Â  Â  Â  allMembers.forEach(m => {
Â  Â  Â  Â  Â  const key = m.name + "||" + m.cohort;
Â  Â  Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  Â  Â  option.value = key;
Â  Â  Â  Â  Â  option.textContent = `${m.name} (${m.cohort}ë˜ë˜)`;
Â  Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  } catch(e) { select.innerHTML = "<option value=''>ë¡œë”© ì‹¤íŒ¨</option>"; }
Â  Â  }
Â  Â  document.getElementById("memberSelect").onchange = loadMemberHistory;
Â  Â  document.getElementById("memberStartDate").onchange = loadMemberHistory;
Â  Â  document.getElementById("memberEndDate").onchange = loadMemberHistory;

Â  Â  async function loadMemberHistory() {
Â  Â  Â  const key = document.getElementById("memberSelect").value;
Â  Â  Â  const start = document.getElementById("memberStartDate").value;
Â  Â  Â  const end = document.getElementById("memberEndDate").value;
Â  Â  Â  const resultArea = document.getElementById("memberResultArea");
Â  Â  Â  const table = document.getElementById("memberHistoryTable");

Â  Â  Â  if (!key) { resultArea.classList.add("hidden"); table.innerHTML = ""; return; }
Â  Â  Â  
Â  Â  Â  resultArea.classList.remove("hidden");
Â  Â  Â  table.innerHTML = "<div class='message info'>ê¸°ë¡ ë¡œë”© ì¤‘...</div>";

Â  Â  Â  const [name, cohort] = key.split("||");
Â  Â  Â  try {
Â  Â  Â  Â  const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getMemberHistory", name, cohort, startDate: start, endDate: end });
Â  Â  Â  Â  if(res.status !== "success") throw new Error();
Â  Â  Â  Â  const { present, total, sessions, monthly } = res.data;

Â  Â  Â  Â  // ìš”ì•½ ì—…ë°ì´íŠ¸
Â  Â  Â  Â  document.getElementById("memPresent").textContent = present;
Â  Â  Â  Â  document.getElementById("memTotal").textContent = total;
Â  Â  Â  Â  document.getElementById("memRate").textContent = total > 0 ? Math.round(present/total*100)+"%" : "0%";

Â  Â  Â  Â  // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
Â  Â  Â  Â  updateMemberChart(monthly);

Â  Â  Â  Â  // í…Œì´ë¸” ì—…ë°ì´íŠ¸
Â  Â  Â  Â  if (sessions.length === 0) { table.innerHTML = "<div class='message info'>í•´ë‹¹ ê¸°ê°„ì— ê¸°ë¡ëœ ì¶œì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }
Â  Â  Â  Â  let html = `<table><thead><tr><th>ë‚ ì§œ</th><th>ì‚¬ë‘ë°©</th><th>ìƒíƒœ</th><th>íŠ¹ì´ì‚¬í•­</th></tr></thead><tbody>`;
Â  Â  Â  Â  sessions.forEach(s => {
Â  Â  Â  Â  Â  const status = s.isPresent ? `<span class="status-badge status-ok">ì¶œì„</span>` : `<span class="status-badge status-no">ê²°ì„</span>`;
Â  Â  Â  Â  Â  html += `<tr><td>${s.date}</td><td>${s.teamName}</td><td>${status}</td><td>${s.note || "-"}</td></tr>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  html += "</tbody></table>";
Â  Â  Â  Â  table.innerHTML = html;

Â  Â  Â  } catch(e) { 
Â  Â  Â  Â  console.error("Member History Error:", e);
Â  Â  Â  Â  table.innerHTML = "<div class='message error'>ê¸°ë¡ ë¡œë”© ì‹¤íŒ¨</div>"; 
Â  Â  Â  }
Â  Â  }
Â  Â  function updateMemberChart(monthlyData) {
Â  Â  Â  const ctx = document.getElementById('memberChart').getContext('2d');
Â  Â  Â  const labels = monthlyData.map(d => d.month);
Â  Â  Â  const data = monthlyData.map(d => Number(d.rate));

Â  Â  Â  if(chartInstance) chartInstance.destroy();
Â  Â  Â  chartInstance = new Chart(ctx, {
Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  data: { labels, datasets: [{
Â  Â  Â  Â  Â  label: 'ì›”ë³„ ì¶œì„ë¥  (%)', data,
Â  Â  Â  Â  Â  borderColor: '#2563eb', backgroundColor: 'rgba(37, 99, 235, 0.1)',
Â  Â  Â  Â  Â  tension: 0.1, fill: true, pointRadius: 4, pointHoverRadius: 6
Â  Â  Â  Â  }] },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,
Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  y: { beginAtZero: true, max: 100, ticks: { callback: (value) => value + '%' } }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  plugins: { tooltip: { callbacks: { label: (context) => context.dataset.label + ': ' + context.parsed.y + '%' } } }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }
Â  Â  document.getElementById("downloadCsvBtn").onclick = () => {
Â  Â  Â  const start = document.getElementById("memberStartDate").value;
Â  Â  Â  const end = document.getElementById("memberEndDate").value;
Â  Â  Â  if (!start || !end) { showMsg("error", "ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤."); return; }
Â  Â  Â  const url = `${GOOGLE_SCRIPT_URL}?action=exportPeriodCsv&startDate=${start}&endDate=${end}`;
Â  Â  Â  window.open(url, "_blank");
Â  Â  };
Â  </script>
</body>
</html>
