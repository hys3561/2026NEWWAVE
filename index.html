<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>뉴웨이브 청1 사랑방 출석체크</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background-color: #f9fafb; min-height: 100vh; }

    .header { background: white; border-bottom: 1px solid #e5e7eb; padding: 1.5rem 1rem; position: sticky; top: 0; z-index: 100; }
    .header-content { max-width: 1200px; margin: 0 auto; position: relative; }
    .header-title { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem; }
    h1 { font-size: 1.5rem; color: #111827; }
    .subtitle { color: #6b7280; font-size: 0.875rem; }
    .admin-button { position: absolute; top: 0; right: 0; background: #6b7280; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 0.875rem; }
    .admin-button:hover { background: #4b5563; }

    .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }

    .team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
    .team-card { background: white; padding: 1.5rem; border-radius: 0.5rem; border: 2px solid #e5e7eb; cursor: pointer; transition: all 0.2s; }
    .team-card:hover { border-color: #2563eb; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    .team-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .team-number { width: 3rem; height: 3rem; background: #dbeafe; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; color: #2563eb; font-weight: bold; font-size: 1.25rem; }
    .team-card:hover .team-number { background: #2563eb; color: white; }
    .member-count { background: #f3f4f6; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; color: #6b7280; }
    .team-name { font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem; }

    .back-button { display: flex; align-items: center; gap: 0.5rem; color: #6b7280; background: none; border: none; cursor: pointer; font-size: 1rem; margin-bottom: 1rem; padding: 0.5rem; }
    .back-button:hover { color: #111827; }

    .date-section { background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; margin-bottom: 1.5rem; }
    .date-label { font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem; }
    .date-input { width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; }

    .summary-box { background: #eff6ff; padding: 1rem; border-radius: 0.5rem; border: 1px solid #bfdbfe; margin-bottom: 1rem; }
    .summary-content { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .summary-count { font-size: 1.5rem; font-weight: bold; color: #2563eb; }
    .progress-bar { background: #e5e7eb; border-radius: 9999px; height: 0.5rem; overflow: hidden; }
    .progress-fill { background: #2563eb; height: 100%; transition: width 0.3s; }

    /* ====== ✅ 스크롤 최적화 핵심: 검색 + 그리드 ====== */
    .search-section { background: white; padding: 0.75rem 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; margin-bottom: 1rem; }
    .search-input { width: 100%; padding: 0.65rem 0.9rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.95rem; }

    .member-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    @media (min-width: 768px) {
      .member-list { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
    }

    .member-item { background: white; padding: 0.85rem; border-radius: 0.5rem; border: 2px solid #e5e7eb; transition: all 0.2s; }
    .member-item.checked { background: #eff6ff; border-color: #2563eb; }

    .member-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; gap: 0.5rem; }
    .member-name { font-size: 1rem; font-weight: 600; color: #374151; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .header-right { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }

    .note-toggle {
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      color: #374151;
      padding: 0.35rem 0.55rem;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .note-toggle:hover { background: #e5e7eb; }

    .checkbox { width: 1.75rem; height: 1.75rem; border-radius: 9999px; border: 2px solid #d1d5db; display: flex; align-items: center; justify-content: center; }
    .member-item.checked .checkbox { background: #2563eb; border-color: #2563eb; }
    .checkmark { display: none; color: white; font-weight: bold; font-size: 0.95rem; }
    .member-item.checked .checkmark { display: block; }

    /* 메모는 기본 접힘 → 필요한 사람만 펼쳐서 입력 */
    .note-section { display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e5e7eb; }
    .member-item.note-open .note-section { display: block; }
    .note-input { width: 100%; padding: 0.55rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; }

    .suggestion-section { background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; margin-bottom: 1.5rem; }
    .suggestion-textarea { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem; min-height: 80px; }

    /* ====== ✅ 하단 고정 저장바(스크롤 줄이기) ====== */
    .sticky-actions {
      position: sticky;
      bottom: 0;
      background: rgba(249, 250, 251, 0.95);
      border-top: 1px solid #e5e7eb;
      padding: 0.75rem 0;
      backdrop-filter: blur(6px);
    }
    .save-button { width: 100%; background: #2563eb; color: white; padding: 0.95rem; border-radius: 0.5rem; border: none; font-size: 1.05rem; font-weight: 700; cursor: pointer; }
    .save-button:hover { background: #1d4ed8; }

    .message { padding: 0.85rem 1rem; border-radius: 0.5rem; text-align: center; font-weight: 600; margin-top: 0.75rem; }
    .message.success { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }

    .admin-login { max-width: 400px; margin: 4rem auto; background: white; padding: 2rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; }
    .login-input { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; margin-bottom: 1rem; }
    .login-button { width: 100%; background: #2563eb; color: white; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; }
    .error-message { color: #dc2626; font-size: 0.875rem; margin-bottom: 1rem; text-align: center; }

    .dashboard-tabs { display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #e5e7eb; }
    .tab-button { padding: 0.75rem 1.5rem; background: none; border: none; cursor: pointer; color: #6b7280; border-bottom: 2px solid transparent; margin-bottom: -2px; }
    .tab-button.active { color: #2563eb; border-bottom-color: #2563eb; font-weight: 600; }

    .attendance-table { background: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; overflow-x: auto; }
    .attendance-table table { width: 100%; border-collapse: collapse; }
    .attendance-table th { background: #f9fafb; padding: 0.75rem; text-align: left; font-size: 0.875rem; font-weight: 600; border-bottom: 1px solid #e5e7eb; }
    .attendance-table td { padding: 0.75rem; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem; }

    .suggestion-list { background: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; padding: 1rem; }
    .suggestion-item { padding: 1rem; border-bottom: 1px solid #e5e7eb; }
    .suggestion-team { font-weight: 600; color: #111827; }

    .hidden { display: none; }
  </style>
</head>

<body>
  <div id="homePage">
    <div class="header">
      <div class="header-content">
        <button class="admin-button" onclick="showAdminLogin()">관리자</button>
        <div class="header-title"><h1>사랑방 출석체크</h1></div>
        <p class="subtitle">사랑방을 선택해주세요</p>
      </div>
    </div>
    <div class="container">
      <div class="team-grid" id="teamGrid"></div>
    </div>
  </div>

  <div id="attendancePage" class="hidden">
    <div class="header">
      <div class="header-content">
        <button class="back-button" onclick="goHome()">← 돌아가기</button>
        <h1 id="selectedTeamName"></h1>
        <p class="subtitle" id="selectedTeamLeader"></p>
      </div>
    </div>

    <div class="container">
      <div class="date-section">
        <div class="date-label">날짜 선택</div>
        <input type="date" class="date-input" id="dateInput" />
      </div>

      <div class="summary-box">
        <div class="summary-content">
          <span>출석 현황</span>
          <span class="summary-count" id="attendanceCount">0 / 0</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <!-- ✅ 검색으로 스크롤 추가 절감 -->
      <div class="search-section">
        <input id="memberSearch" class="search-input" placeholder="이름 검색 (예: 홍길동)" />
      </div>

      <div class="member-list" id="memberList"></div>

      <div class="suggestion-section">
        <div class="date-label">건의사항 (선택)</div>
        <textarea class="suggestion-textarea" id="suggestionInput" placeholder="건의사항을 작성해주세요"></textarea>
      </div>

      <!-- ✅ 하단 고정 저장바 -->
      <div class="sticky-actions">
        <button class="save-button" onclick="saveAttendance()">출석 정보 저장</button>
        <div id="messageBox" class="hidden"></div>
      </div>
    </div>
  </div>

  <div id="adminLoginPage" class="hidden">
    <div class="header">
      <div class="header-content">
        <button class="back-button" onclick="goHome()">← 돌아가기</button>
      </div>
    </div>

    <div class="admin-login">
      <h1 style="text-align:center;margin-bottom:1.5rem;">관리자 로그인</h1>
      <div id="loginError" class="error-message hidden"></div>
      <input type="password" class="login-input" id="adminPassword" placeholder="비밀번호" />
      <button class="login-button" onclick="adminLogin()">로그인</button>
    </div>
  </div>

  <div id="adminDashboard" class="hidden">
    <div class="header">
      <div class="header-content">
        <button class="back-button" onclick="goHome()">← 돌아가기</button>
        <h1>관리자 대시보드</h1>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-tabs">
        <button class="tab-button active" onclick="switchTab('stats')">출석 현황</button>
        <button class="tab-button" onclick="switchTab('suggestions')">건의사항</button>
      </div>

      <div id="statsTab">
        <div class="date-section">
          <div class="date-label">주차 선택</div>
          <input type="date" class="date-input" id="adminDateInput" />
        </div>
        <div class="attendance-table" id="attendanceTable"></div>
      </div>

      <div id="suggestionsTab" class="hidden">
        <div class="suggestion-list" id="suggestionsList"></div>
      </div>
    </div>
  </div>

  <script>
    var GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
    var ADMIN_PASSWORD = 'newwave2026';

    var TEAMS = [
      {id:1,name:'권준형 사랑방',leader:'방장: 권준형',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:2,name:'김나림 사랑방',leader:'방장: 김나림',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:3,name:'문유안 사랑방',leader:'방장: 문유안',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:4,name:'벡에스더 사랑방',leader:'방장: 벡에스더',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:5,name:'이예정 사랑방',leader:'방장: 이예정',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:6,name:'이지빈 사랑방',leader:'방장: 이지빈',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:7,name:'이하은 사랑방',leader:'방장: 이하은',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:8,name:'이희진 사랑방',leader:'방장: 이희진',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:9,name:'임사랑 사랑방',leader:'방장: 임사랑',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:10,name:'장하늘 사랑방',leader:'방장: 장하늘',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:11,name:'하재영 사랑방',leader:'방장: 하재영',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']},
      {id:12,name:'Wee팀',leader:'방장: Wee팀',members:['방원1','방원2','방원3','방원4','방원5','방원6','방원7','방원8','방원9','방원10','방원11','방원12','방원13','방원14','방원15','방원16','방원17','방원18','방원19','방원20']}
    ];

    var selectedTeam = null;
    var attendance = {};
    var memberNotes = {};

    var today = new Date().toISOString().split('T')[0];
    document.getElementById('dateInput').value = today;
    document.getElementById('adminDateInput').value = today;

    // ===== 로컬 저장/복원(팀+날짜별) =====
    var STORAGE_PREFIX = 'nw_attendance_v1';

    function storageKey(teamId, date) {
      return STORAGE_PREFIX + ':' + teamId + ':' + date;
    }

    function safeParseJSON(s) {
      try { return JSON.parse(s); } catch (e) { return null; }
    }

    function persistLocal() {
      if (!selectedTeam) return;
      var date = document.getElementById('dateInput').value;
      var payload = {
        attendance: attendance || {},
        notes: memberNotes || {},
        suggestion: document.getElementById('suggestionInput').value || ''
      };
      localStorage.setItem(storageKey(selectedTeam.id, date), JSON.stringify(payload));
    }

    function restoreLocal() {
      if (!selectedTeam) return;

      var date = document.getElementById('dateInput').value;
      var saved = safeParseJSON(localStorage.getItem(storageKey(selectedTeam.id, date)));

      attendance = (saved && saved.attendance) ? saved.attendance : {};
      memberNotes = (saved && saved.notes) ? saved.notes : {};
      document.getElementById('suggestionInput').value = (saved && saved.suggestion) ? saved.suggestion : '';

      selectedTeam.members.forEach(function(name) {
        var sel = '.member-item[data-name="' + (window.CSS && CSS.escape ? CSS.escape(name) : name.replace(/"/g, '\\"')) + '"]';
        var item = document.querySelector(sel);
        if (!item) return;

        item.classList.toggle('checked', !!attendance[name]);

        var input = item.querySelector('.note-input');
        if (input) input.value = memberNotes[name] || '';

        // ✅ 메모가 있으면 자동으로 펼쳐두기(필요한 사람만 높이 증가)
        item.classList.toggle('note-open', !!(memberNotes[name] && memberNotes[name].trim()));
      });

      updateCount();
    }

    function initTeamGrid(){
      var g = document.getElementById('teamGrid');
      g.innerHTML = '';
      TEAMS.forEach(function(t){
        var c = document.createElement('div');
        c.className = 'team-card';
        c.onclick = function(){ selectTeam(t); };
        c.innerHTML =
          '<div class="team-card-header">' +
            '<div class="team-number">' + t.id + '</div>' +
            '<div class="member-count">' + t.members.length + '명</div>' +
          '</div>' +
          '<div class="team-name">' + t.name + '</div>' +
          '<p style="font-size:0.875rem;color:#6b7280;">' + t.leader + '</p>';
        g.appendChild(c);
      });
    }

    function selectTeam(t){
      selectedTeam = t;
      attendance = {};
      memberNotes = {};

      document.getElementById('selectedTeamName').textContent = t.name;
      document.getElementById('selectedTeamLeader').textContent = t.leader;

      var m = document.getElementById('memberList');
      m.innerHTML = '';

      t.members.forEach(function(n){
        var item = document.createElement('div');
        item.className = 'member-item';
        item.setAttribute('data-name', n);

        var header = document.createElement('div');
        header.className = 'member-header';
        header.setAttribute('data-name', n);

        var nameSpan = document.createElement('span');
        nameSpan.className = 'member-name';
        nameSpan.textContent = n;

        var right = document.createElement('div');
        right.className = 'header-right';

        var noteBtn = document.createElement('button');
        noteBtn.type = 'button';
        noteBtn.className = 'note-toggle';
        noteBtn.textContent = '메모';

        var checkbox = document.createElement('div');
        checkbox.className = 'checkbox';
        var mark = document.createElement('span');
        mark.className = 'checkmark';
        mark.textContent = '✓';
        checkbox.appendChild(mark);

        right.appendChild(noteBtn);
        right.appendChild(checkbox);

        header.appendChild(nameSpan);
        header.appendChild(right);

        var note = document.createElement('div');
        note.className = 'note-section';
        var input = document.createElement('input');
        input.type = 'text';
        input.className = 'note-input';
        input.placeholder = '특이사항 입력';
        input.setAttribute('data-name', n);
        note.appendChild(input);

        item.appendChild(header);
        item.appendChild(note);
        m.appendChild(item);
      });

      // 검색 초기화
      document.getElementById('memberSearch').value = '';
      // 저장값 복원
      restoreLocal();
      // 필터 적용(전체 표시)
      applyMemberFilter('');

      hideAll();
      document.getElementById('attendancePage').classList.remove('hidden');
    }

    function toggleMember(n){
      attendance[n] = !attendance[n];

      var sel = '.member-item[data-name="' + (window.CSS && CSS.escape ? CSS.escape(n) : n.replace(/"/g, '\\"')) + '"]';
      var item = document.querySelector(sel);
      if (item) item.classList.toggle('checked', !!attendance[n]);

      updateCount();
      persistLocal();
    }

    function updateNote(n,v){
      memberNotes[n] = v;
    }

    function updateCount(){
      var c = 0;
      for (var k in attendance) if (attendance[k]) c++;
      var t = selectedTeam ? selectedTeam.members.length : 0;
      document.getElementById('attendanceCount').textContent = c + ' / ' + t;
      document.getElementById('progressFill').style.width = (t > 0 ? (c / t) * 100 : 0) + '%';
    }

    function saveAttendance(){
      var d = {
        team: selectedTeam.name,
        leader: selectedTeam.leader,
        date: document.getElementById('dateInput').value,
        suggestion: document.getElementById('suggestionInput').value,
        attendance: selectedTeam.members.map(function(m){
          return { name: m, present: attendance[m] || false, note: memberNotes[m] || '' };
        }),
        timestamp: new Date().toISOString()
      };

      persistLocal();

      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(d)
      }).then(function(){
        var b = document.getElementById('messageBox');
        b.className = 'message success';
        b.textContent = '저장되었습니다!';
        b.classList.remove('hidden');
        setTimeout(function(){ b.classList.add('hidden'); }, 2500);
      }).catch(function(){});
    }

    function showAdminLogin(){
      hideAll();
      document.getElementById('adminLoginPage').classList.remove('hidden');
    }

    function adminLogin(){
      var p = document.getElementById('adminPassword').value;
      if (p === ADMIN_PASSWORD) {
        hideAll();
        document.getElementById('adminDashboard').classList.remove('hidden');
        loadAdminData();
      } else {
        document.getElementById('loginError').textContent = '비밀번호가 틀렸습니다.';
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    function switchTab(t){
      var tabs = document.querySelectorAll('.tab-button');
      for (var i=0; i<tabs.length; i++) tabs[i].classList.remove('active');

      if (t === 'stats') {
        tabs[0].classList.add('active');
        document.getElementById('statsTab').classList.remove('hidden');
        document.getElementById('suggestionsTab').classList.add('hidden');
      } else {
        tabs[1].classList.add('active');
        document.getElementById('statsTab').classList.add('hidden');
        document.getElementById('suggestionsTab').classList.remove('hidden');
      }
    }

    function loadAdminData(){
      document.getElementById('attendanceTable').innerHTML =
        '<table>' +
          '<thead><tr><th>사랑방</th><th>방장</th><th>출석</th><th>결석</th><th>출석률</th></tr></thead>' +
          '<tbody><tr><td colspan="5" style="text-align:center;color:#6b7280;">데이터 로드 중...</td></tr></tbody>' +
        '</table>';

      document.getElementById('suggestionsList').innerHTML =
        '<div style="text-align:center;color:#6b7280;padding:2rem;">건의사항이 없습니다.</div>';
    }

    function goHome(){
      hideAll();
      document.getElementById('homePage').classList.remove('hidden');
    }

    function hideAll(){
      document.getElementById('homePage').classList.add('hidden');
      document.getElementById('attendancePage').classList.add('hidden');
      document.getElementById('adminLoginPage').classList.add('hidden');
      document.getElementById('adminDashboard').classList.add('hidden');
    }

    // ===== ✅ 검색 필터 =====
    function applyMemberFilter(q){
      q = (q || '').trim().toLowerCase();
      var items = document.querySelectorAll('#memberList .member-item');
      for (var i=0; i<items.length; i++){
        var name = (items[i].getAttribute('data-name') || '').toLowerCase();
        items[i].style.display = name.indexOf(q) >= 0 ? '' : 'none';
      }
    }

    // ===== 이벤트(한 번만 등록) =====
    document.getElementById('memberList').addEventListener('click', function(e){
      // 메모 버튼 클릭 시: 출석 토글하지 말고, 메모 영역만 펼치기/접기
      var noteBtn = e.target.closest('.note-toggle');
      if (noteBtn) {
        var item = e.target.closest('.member-item');
        if (!item) return;
        item.classList.toggle('note-open');
        var input = item.querySelector('.note-input');
        if (input && item.classList.contains('note-open')) setTimeout(function(){ input.focus(); }, 0);
        return;
      }

      var header = e.target.closest('.member-header');
      if (!header) return;
      toggleMember(header.getAttribute('data-name'));
    });

    document.getElementById('memberList').addEventListener('input', function(e){
      if (!e.target.classList.contains('note-input')) return;
      var name = e.target.getAttribute('data-name');
      updateNote(name, e.target.value);
      persistLocal();

      // 메모가 생기면 자동으로 open 상태 유지
      var item = e.target.closest('.member-item');
      if (item) item.classList.toggle('note-open', !!e.target.value.trim());
    });

    document.getElementById('suggestionInput').addEventListener('input', function(){
      persistLocal();
    });

    document.getElementById('dateInput').addEventListener('change', function(){
      restoreLocal();
      applyMemberFilter(document.getElementById('memberSearch').value);
    });

    document.getElementById('memberSearch').addEventListener('input', function(){
      applyMemberFilter(this.value);
    });

    initTeamGrid();
  </script>
</body>
</html>
