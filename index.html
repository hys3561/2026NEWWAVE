<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‰´ì›¨ì´ë¸Œ ì²­ë…„1ë¶€ ì‚¬ë‘ë°© ì¶œì„ì²´í¬</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:#f9fafb; min-height:100vh; }
    .hidden { display:none !important; }

    .header { background:#fff; border-bottom:1px solid #e5e7eb; padding:1.25rem 1rem; position:sticky; top:0; z-index:100; }
    .header-content { max-width:1200px; margin:0 auto; position:relative; }
    h1 { font-size:1.5rem; color:#111827; }
    .subtitle { color:#6b7280; font-size:0.9rem; font-weight:800; margin-top:0.35rem; }
    .admin-button { position:absolute; top:0; right:0; background:#6b7280; color:#fff; padding:0.5rem 1rem; border-radius:0.85rem; border:none; cursor:pointer; font-size:0.875rem; font-weight:900; }

    .container { max-width:1200px; margin:0 auto; padding:1.5rem 1rem; }

    /* ë©”ì¸ ì‚¬ë‘ë°© ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .team-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:1rem; }
    .team-card { background:#fff; padding:1.5rem; border-radius:0.95rem; border:2px solid #e5e7eb; cursor:pointer; transition:all .2s; }
    .team-card:hover { border-color:#2563eb; box-shadow:0 10px 15px -3px rgba(0,0,0,.1); }
    .team-card-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; }
    .team-number { width:2.5rem; height:2.5rem; background:#dbeafe; border-radius:0.9rem; display:flex; align-items:center; justify-content:center; color:#2563eb; font-weight:950; font-size:1rem; }
    .team-name { font-size:1.65rem; font-weight:950; color:#111827; margin-bottom:.25rem; }
    .team-leader { font-size:.9rem; color:#6b7280; font-weight:800; }
    .member-count { background:#f3f4f6; padding:.25rem .75rem; border-radius:9999px; font-size:.875rem; color:#6b7280; font-weight:900; }

    .back-button { display:flex; align-items:center; gap:.5rem; color:#6b7280; background:none; border:none; cursor:pointer; font-size:1rem; padding:.5rem .25rem; font-weight:900; }

    .date-section { background:#fff; padding:1rem; border-radius:.95rem; border:1px solid #e5e7eb; margin-bottom:1rem; }
    .date-label { font-size:.875rem; font-weight:950; color:#374151; margin-bottom:.5rem; }
    .date-row { display:flex; gap:.5rem; }
    .date-input { flex:1; padding:.75rem 1rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; background:#fff; }
    .load-button { background:#4b5563; color:white; border:none; padding:0 1.2rem; border-radius:.9rem; font-weight:900; cursor:pointer; }

    .summary-box { background:#eff6ff; padding:1rem; border-radius:.95rem; border:1px solid #bfdbfe; margin-bottom:1rem; }
    .summary-content { display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem; }
    .summary-title { font-weight:950; color:#111827; }
    .summary-count { font-size:1.5rem; font-weight:950; color:#2563eb; }
    .progress-bar { background:#e5e7eb; border-radius:9999px; height:.5rem; overflow:hidden; }
    .progress-fill { background:#2563eb; height:100%; transition:width .3s; }

    .search-input { width:100%; padding:.65rem .9rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; margin-bottom:1rem; }

    /* ì‚¬ë‘ë°© ëª…ë‹¨ ê·¸ë¦¬ë“œ */
    .member-list { display:grid; grid-template-columns:repeat(auto-fill, minmax(170px, 1fr)); gap:.75rem; margin-bottom:1rem; }
    .member-item { background:#fff; padding:.9rem; border-radius:.95rem; border:2px solid #e5e7eb; transition:all .2s; }
    .member-item.checked { background:#eff6ff; border-color:#2563eb; }
    .member-header { display:flex; justify-content:space-between; align-items:flex-start; cursor:pointer; gap:.5rem; }
    .member-name { font-size:1rem; font-weight:950; color:#374151; }
    .member-meta { margin-top:.2rem; font-size:.85rem; font-weight:900; color:#6b7280; }
    .checkbox { width:1.75rem; height:1.75rem; border-radius:9999px; border:2px solid #d1d5db; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:.1rem; }
    .member-item.checked .checkbox { background:#2563eb; border-color:#2563eb; }
    .checkmark { display:none; color:#fff; font-weight:950; font-size:.95rem; }
    .member-item.checked .checkmark { display:block; }

    .note-input { width:100%; padding:.55rem .65rem; border:1px solid #d1d5db; border-radius:.85rem; font-size:14px; margin-top:0.75rem; }
    .suggestion-textarea { width:100%; padding:.75rem; border:1px solid #d1d5db; border-radius:.9rem; font-size:16px; min-height:90px; }

    .save-button { width:100%; background:#2563eb; color:#fff; padding:.95rem; border-radius:.95rem; border:none; font-size:1.05rem; font-weight:950; cursor:pointer; }
    
    .message { padding:.85rem 1rem; border-radius:.95rem; text-align:center; font-weight:950; margin-top:.75rem; }
    .message.success { background:#f0fdf4; color:#15803d; border:1px solid #bbf7d0; }
    .message.error { background:#fef2f2; color:#b91c1c; border:1px solid #fecaca; }
    .message.info { background:#eff6ff; color:#1d4ed8; border:1px solid #bfdbfe; }

    /* ê´€ë¦¬ì íƒ­ ë””ìì¸ */
    .dashboard-tabs { display:flex; gap:1rem; margin-bottom:1.25rem; border-bottom:2px solid #e5e7eb; overflow-x:auto; }
    .tab-button { padding:0.75rem 1.25rem; font-size:1rem; background:none; border:none; cursor:pointer; color:#6b7280; border-bottom:2px solid transparent; margin-bottom:-2px; font-weight:950; white-space:nowrap; }
    .tab-button.active { color:#2563eb; border-bottom-color:#2563eb; }

    .attendance-table { background:#fff; border-radius:.95rem; border:1px solid #e5e7eb; overflow:hidden; }
    table { width:100%; border-collapse:collapse; }
    th { background:#f9fafb; padding:1rem; text-align:left; font-size:.95rem; font-weight:950; border-bottom:1px solid #e5e7eb; }
    td { padding:1rem; border-bottom:1px solid #e5e7eb; font-size:.95rem; vertical-align:middle; }

    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:999; }
    .modal { background:#fff; width:90%; max-width:400px; padding:1.5rem; border-radius:1rem; }
    .modal-actions { display:flex; gap:0.5rem; margin-top:1rem; }
    .modal-btn { flex:1; padding:0.8rem; border-radius:0.5rem; border:none; font-weight:bold; cursor:pointer; }
    .modal-btn.primary { background:#2563eb; color:#fff; }
  </style>
</head>
<body>

  <div id="homePage">
    <div class="header">
      <div class="header-content">
        <button type="button" class="admin-button" id="adminBtn">ê´€ë¦¬ì</button>
        <h1>ë‰´ì›¨ì´ë¸Œ ì²­ë…„1ë¶€</h1>
        <p class="subtitle">ì¶œì„ ì²´í¬ë¥¼ ìœ„í•´ ì‚¬ë‘ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
      </div>
    </div>
    <div class="container">
      <div class="team-grid" id="teamGrid"></div>
    </div>
  </div>

  <div id="attendancePage" class="hidden">
    <div class="header">
      <div class="header-content">
        <button type="button" class="back-button" id="teamBackBtn">â† ë’¤ë¡œê°€ê¸°</button>
        <h1 id="selectedTeamName"></h1>
        <p class="subtitle" id="selectedTeamLeader"></p>
      </div>
    </div>
    <div class="container">
      <div class="date-section">
        <div class="date-label">ë‚ ì§œ ì„ íƒ</div>
        <div class="date-row">
          <input type="date" class="date-input" id="dateInput" />
          <button type="button" class="load-button" id="forceLoadBtn">ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
      </div>

      <div class="summary-box">
        <div class="summary-content">
          <span class="summary-title">ì˜¤ëŠ˜ì˜ ì¶œì„ ì¸ì›</span>
          <span class="summary-count" id="attendanceCount">0 / 0</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width:0%"></div>
        </div>
      </div>

      <input id="memberSearch" class="search-input" placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." />
      <div class="member-list" id="memberList"></div>

      <div style="margin-bottom:1rem;">
        <div class="date-label">ê±´ì˜ì‚¬í•­ ë° ê¸°íƒ€ (ì„ íƒì‚¬í•­)</div>
        <textarea class="suggestion-textarea" id="suggestionInput" placeholder="ê³µë™ì²´ì— ì „ë‹¬í•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>

      <div style="position:sticky; bottom:1rem;">
        <button type="button" class="save-button" id="saveBtn">ì¶œì„ ì •ë³´ ì €ì¥í•˜ê¸°</button>
        <div id="messageBox" class="hidden"></div>
      </div>
    </div>
  </div>

  <div id="adminDashboard" class="hidden">
    <div class="header">
      <div class="header-content">
        <button type="button" class="back-button" id="adminBackBtn">â† í™ˆìœ¼ë¡œ</button>
        <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
      </div>
    </div>
    <div class="container">
      <div class="dashboard-tabs">
        <button class="tab-button active" data-tab="stats">ì¶œì„ í˜„í™©</button>
        <button class="tab-button" data-tab="notes">íŠ¹ì´ì‚¬í•­</button>
        <button class="tab-button" data-tab="suggestions">ê±´ì˜ì‚¬í•­</button> 
        <button class="tab-button" data-tab="members">ê°œì¸ë³„ ì¡°íšŒ</button>
      </div>

      <div id="adminStatsTab">
        <div class="date-section">
          <input type="date" class="date-input" id="adminDateInput" />
        </div>
        <div class="attendance-table" id="attendanceTable"></div>
      </div>

      <div id="adminNotesTab" class="hidden">
        <div class="date-section">
          <input type="date" class="date-input" id="adminNotesDateInput" />
        </div>
        <div id="notesTable" class="attendance-table"></div>
      </div>

      <div id="adminSuggestionsTab" class="hidden">
        <div class="date-section">
          <input type="date" class="date-input" id="adminSuggestionsDateInput" />
        </div>
        <div id="suggestionsTable" class="attendance-table"></div>
      </div>

      <div id="adminMembersTab" class="hidden">
        <div class="date-section">
          <div class="date-label">ì¡°íšŒ ê¸°ê°„</div>
          <div style="display:flex; gap:5px; margin-bottom:10px;">
            <input type="date" id="memberStartDate" class="date-input" />
            <input type="date" id="memberEndDate" class="date-input" />
          </div>
          <select id="memberSelect" class="date-input" style="width:100%">
            <option value="">ë°©ì› ì„ íƒ</option>
          </select>
          <button id="saveToSheetBtn" class="load-button" style="width:100%; margin-top:10px; background:#059669; color:white; height:45px;">ğŸ“Š í†µê³„ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì €ì¥</button>
        </div>
        <div id="memberResultArea" class="hidden">
          <div style="background:white; padding:15px; border-radius:15px; margin-bottom:15px; border:1px solid #e5e7eb;">
            <canvas id="memberChart" style="max-height:200px; width:100%;"></canvas>
          </div>
          <div id="memberHistoryTable" class="attendance-table"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="passwordModal" class="modal-overlay hidden">
    <div class="modal">
      <h3 id="modalSubtitle">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
      <input type="password" id="modalPassword" class="date-input" style="margin-top:10px; width:100%" />
      <div id="modalError" style="color:red; font-size:0.8rem; margin-top:5px;" class="hidden">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
      <div class="modal-actions">
        <button class="modal-btn" id="modalCancelBtn">ì·¨ì†Œ</button>
        <button class="modal-btn primary" id="modalOkBtn">í™•ì¸</button>
      </div>
    </div>
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzAVZkfYIhgTLmxdt-iKf5VBfu6AsfpsYKxXe2tiNbItKD7SFDc7dsm07w8z_JtuWteTg/exec";
    
    const TEAMS = [
  {
    id: 1,
    name: "ê¶Œì¤€í˜• ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ê¶Œì¤€í˜•",
    members: [
      { name: "ê¶Œì¤€í˜•", cohort: "99" },
      { name: "ê¹€ì‹œì•„", cohort: "01" },
      { name: "ê¹€ì˜ˆì¤€", cohort: "06" },
      { name: "ê¹€ìš°ì£¼", cohort: "06" },
      { name: "ê¹€í•´ì„±", cohort: "02" },
      { name: "ë§¹ì„±ì›", cohort: "06" },
      { name: "ì‹ ì¬ì˜", cohort: "00" },
      { name: "ì˜¤ì„¸í˜„", cohort: "01" },
      { name: "ì›ì°¬í¬", cohort: "01" },
      { name: "ìœ¤ë¦¬ê²½", cohort: "00" },
      { name: "ì´ë¯¼ì •", cohort: "00" },
      { name: "ì´ì˜ˆì€", cohort: "00" },
      { name: "ì¡°ì—ë…¹", cohort: "02" },
      { name: "ì°¨í•´ì˜¨", cohort: "00" },
      { name: "ìµœë™í•˜", cohort: "06" },
      { name: "ìµœì„œì—°", cohort: "00" },
      { name: "í™©ì¬ì¤€", cohort: "03" }
    ]
  },
  {
    id: 2,
    name: "ê¹€ë‚˜ë¦¼ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ê¹€ë‚˜ë¦¼",
    members: [
      { name: "ê¹€ë‚˜ë¦¼", cohort: "03" },
      { name: "ê°•ê·œí˜¸", cohort: "06" },
      { name: "ê¶Œì„¸ì˜", cohort: "04" },
      { name: "ê¹€ìƒˆë¡", cohort: "01" },
      { name: "ê¹€ì‹œìš°", cohort: "01" },
      { name: "ê¹€ì˜ˆì§„", cohort: "06" },
      { name: "ê¹€ìœ ì°¬", cohort: "06" },
      { name: "ê¹€í•´ë¯¼", cohort: "07" },
      { name: "ë°•ìœ¤í™”", cohort: "07" },
      { name: "ë°•ì¢…ì€", cohort: "04" },
      { name: "ë°°ìˆ˜ì•„", cohort: "04" },
      { name: "ì‹¬ì´ì‚­", cohort: "06" },
      { name: "ì´ë˜ì¤€", cohort: "06" },
      { name: "ì´ì„¸ì›", cohort: "04" },
      { name: "ì´ìˆ˜í˜„", cohort: "07" },
      { name: "ì´í•˜í¬", cohort: "04" },
      { name: "ì´í•´ë¯¼", cohort: "07" }
    ]
  },
  {
    id: 3,
    name: "ë¬¸ìœ ì•ˆ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ë¬¸ìœ ì•ˆ",
    members: [
      { name: "ë¬¸ìœ ì•ˆ", cohort: "03" },
      { name: "ê³ ë™í˜„", cohort: "06" },
      { name: "ê¶ŒìŠ¹ì§€", cohort: "05" },
      { name: "ê¹€ë„í˜„", cohort: "07" },
      { name: "ê¹€ì˜ˆì›", cohort: "05" },
      { name: "ê¹€ìœ ê²½", cohort: "05" },
      { name: "ê¹€í•˜ì¤€", cohort: "06" },
      { name: "ë°•ìŠ¹í¬", cohort: "03" },
      { name: "ë°•ì§€ì„±", cohort: "07" },
      { name: "ë°•í˜œì§„", cohort: "02" },
      { name: "ì—°ìœ ë‚˜", cohort: "04" },
      { name: "ì´ì„±ë¯¼", cohort: "07" },
      { name: "ì´ ìˆ˜", cohort: "06" },
      { name: "ì´ìˆ˜ë¹ˆ", cohort: "04" },
      { name: "ì´í¬ì›", cohort: "05" },
      { name: "ì„ì•„í˜„", cohort: "06" },
      { name: "ì¥í˜œì¤€", cohort: "03" },
      { name: "ì •ì„œì—°", cohort: "05" }
    ]
  },
  {
    id: 4,
    name: "ë°±ì—ìŠ¤ë” ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ë°±ì—ìŠ¤ë”",
    members: [
      { name: "ë°±ì—ìŠ¤ë”", cohort: "02" },
      { name: "ê°•ìœ ë‚˜", cohort: "07" },
      { name: "ê¹€ë™ì€", cohort: "05" },
      { name: "ë§ˆí˜œë¦¬", cohort: "04" },
      { name: "ë°•ì„œë¦¼", cohort: "05" },
      { name: "ë°±ë¯¼ì„œ", cohort: "05" },
      { name: "ë°±ìŠ¹ìš°", cohort: "05" },
      { name: "ì´ë™í™”", cohort: "03" },
      { name: "ì´ë¯¼ì§€", cohort: "04" },
      { name: "ì´ì„±ì¤€", cohort: "05" },
      { name: "ì´ì„œí˜„b", cohort: "07" },
      { name: "ì´ì˜ˆì§„", cohort: "03" },
      { name: "ì˜¤í•˜ëŠ˜", cohort: "04" },
      { name: "ìœ ì§€í˜œ", cohort: "02" },
      { name: "ì¥ì¤€í™˜", cohort: "01" },
      { name: "ì¥ì§„ìš°", cohort: "05" },
      { name: "ì¥í•˜ë‚˜", cohort: "07" },
      { name: "ì²œì˜ˆë¹ˆ", cohort: "04" },
      { name: "ì²œìœ ë¹ˆ", cohort: "07" },
      { name: "ìµœí•˜ì€", cohort: "04" }
    ]
  },
  {
    id: 5,
    name: "ì´ì˜ˆì • ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì´ì˜ˆì •",
    members: [
      { name: "ì´ì˜ˆì •", cohort: "98" },
      { name: "ê¶Œì±„ë¯¼", cohort: "05" },
      { name: "ë‚˜ì˜ˆì•ˆ", cohort: "04" },
      { name: "ë§ˆí˜„ë¹ˆ", cohort: "02" },
      { name: "ë°•ê·œë¦¬", cohort: "04" },
      { name: "ë°•ì€ê²½", cohort: "01" },
      { name: "ë°•ì¢…ìš´", cohort: "02" },
      { name: "ë°•íƒœí¬", cohort: "03" },
      { name: "ì–‘ì‚°ì–¼", cohort: "99" },
      { name: "ì˜¤ì„±í—Œ", cohort: "99" },
      { name: "ì´ë³‘í—Œ", cohort: "99" },
      { name: "ì´ì˜ì±„", cohort: "06" },
      { name: "ì´ì°½í˜¸", cohort: "01" },
      { name: "ì •ë‹¤ì›", cohort: "02" },
      { name: "ì •ì—¬ì›", cohort: "05" },
      { name: "í•˜ì„±ë¯¼", cohort: "99" }
    ]
  },
  {
    id: 6,
    name: "ì´ì§€ë¹ˆ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì´ì§€ë¹ˆ",
    members: [
      { name: "ì´ì§€ë¹ˆ", cohort: "03" },
      { name: "ê³½ì±„ìœ¨", cohort: "06" },
      { name: "ê¶Œì˜ˆì€", cohort: "06" },
      { name: "ê¹€ë„ì˜", cohort: "07" },
      { name: "ê¹€ìŠ¹ì›", cohort: "08" },
      { name: "ê¹€ì€ì°¬", cohort: "05" },
      { name: "ë°•ìˆ˜ë¹ˆ", cohort: "03" },
      { name: "ì‹ ë¯¼ê·œ", cohort: "03" },
      { name: "ì˜í† ", cohort: "03" },
      { name: "ì˜¤ì¤€í™˜", cohort: "06" },
      { name: "ì˜¤ì§€ìœ¤", cohort: "06" },
      { name: "ì´ì‹œí—Œ", cohort: "07" },
      { name: "ì¥ë™ì£¼", cohort: "05" },
      { name: "ì •ì˜ˆì›", cohort: "06" },
      { name: "ì •í•˜ì¤€", cohort: "07" },
      { name: "ìµœìˆ˜ì•ˆ", cohort: "06" },
      { name: "í•œë‹¤ì—°", cohort: "04" },
      { name: "í™©ìœ¤ìˆ˜", cohort: "03" }
    ]
  },
  {
    id: 7,
    name: "ì´í•˜ì€ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì´í•˜ì€",
    members: [
      { name: "ì´í•˜ì€", cohort: "05" },
      { name: "ê¹€ë³‘í˜„", cohort: "04" },
      { name: "ê¹€ë³´ì€", cohort: "02" },
      { name: "ë‚¨í•˜ì€", cohort: "05" },
      { name: "ë°•ë¯¼ìš©", cohort: "01" },
      { name: "ë°±í•œë‚˜", cohort: "04" },
      { name: "ì†ìƒê·œ", cohort: "04" },
      { name: "ì†Œìœ¤ì•„", cohort: "07" },
      { name: "ì›ì°¬ì˜", cohort: "02" },
      { name: "ì´ë™ì¸", cohort: "06" },
      { name: "ì´ë¯¼ê·œ", cohort: "03" },
      { name: "ì´ì„œí˜„a", cohort: "07" },
      { name: "ì´ì„¸ë¦°", cohort: "07" },
      { name: "ì¥ìœ¤ì§„", cohort: "04" },
      { name: "í•˜ì§€í—Œ", cohort: "05" },
      { name: "í•œì‹œí˜„", cohort: "06" },
      { name: "í—ˆì‹œì˜¨", cohort: "01" }
    ]
  },
  {
    id: 8,
    name: "ì´í¬ì§„ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì´í¬ì§„",
    members: [
      { name: "ì´í¬ì§„", cohort: "00" },
      { name: "ê¹€ì‹œìœ¤", cohort: "07" },
      { name: "ê¹€ì£¼ì•„", cohort: "05" },
      { name: "ê¹€ì§€ìƒ", cohort: "05" },
      { name: "ë…¸í•˜í˜•", cohort: "04" },
      { name: "ë°•ìƒí˜¸", cohort: "07" },
      { name: "ì„ ë¯¼ì˜", cohort: "05" },
      { name: "ì‹¬ìœ ë‚˜", cohort: "02" },
      { name: "ì‹ í˜œì„±", cohort: "06" },
      { name: "ìœ¤ì´ì•ˆ", cohort: "05" },
      { name: "ì´ìƒê²½", cohort: "00" },
      { name: "ì´ì„œë¥œ", cohort: "05" },
      { name: "ì„í‰ê°•", cohort: "00" },
      { name: "ì¥ìœ¤ì„±", cohort: "07" },
      { name: "ì¥í•´ìœ¤", cohort: "02" },
      { name: "ì •ì˜ˆí”", cohort: "05" },
      { name: "ì •ì¤€", cohort: "05" },
      { name: "ì¡°ë‚˜ë‹¨", cohort: "06" },
      { name: "ì°¨ìœ¤ë¯¸", cohort: "02" },
      { name: "ì²œìœ ì°¬", cohort: "07" },
      { name: "í™í˜œì›", cohort: "05" }
    ]
  },
  {
    id: 9,
    name: "ì„ì‚¬ë‘ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì„ì‚¬ë‘",
    members: [
      { name: "ì„ì‚¬ë‘", cohort: "01" },
      { name: "ê¹€ì€ì„±", cohort: "02" },
      { name: "ê¹€ì œí˜„", cohort: "05" },
      { name: "ê¹€ì¢…ì°¬", cohort: "07" },
      { name: "ë¥˜ì˜ì„œ", cohort: "07" },
      { name: "ë°•ìˆ˜ì˜ˆ", cohort: "07" },
      { name: "ë°°í˜„ì•„", cohort: "07" },
      { name: "ì‹ ì˜ì€", cohort: "05" },
      { name: "ì•ˆìˆ˜ì§€", cohort: "07" },
      { name: "ì•ˆì§„ì£¼", cohort: "06" },
      { name: "ìœ¤ì„œë¹ˆ", cohort: "06" },
      { name: "ìœ¤ì¤€ì„œ", cohort: "03" },
      { name: "ì´ìƒí˜", cohort: "01" },
      { name: "ì´ë‚˜ë¦¼", cohort: "03" },
      { name: "ì´ì°¬í¬", cohort: "06" },
      { name: "ì´í•˜ê²½", cohort: "02" },
      { name: "ì¥ìˆ˜í™˜", cohort: "03" },
      { name: "ìµœê°€ì˜¨", cohort: "05" }
    ]
  },
  {
    id: 10,
    name: "ì¥í•˜ëŠ˜ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: ì¥í•˜ëŠ˜",
    members: [
      { name: "ì¥í•˜ëŠ˜", cohort: "00" },
      { name: "ê¶Œì¤€í˜•", cohort: "07" },
      { name: "ê¹€ìˆ˜ì•„a", cohort: "05" },
      { name: "ê¹€ìˆ˜ì•„b", cohort: "05" },
      { name: "ê¹€ì•„ì¸", cohort: "07" },
      { name: "ê¹€ì€ì£¼b", cohort: "07" },
      { name: "ê¹€ì œë¯¼", cohort: "06" },
      { name: "ë°•ì •ë¯¼", cohort: "07" },
      { name: "ë°•ì¢…í™”", cohort: "05" },
      { name: "ë°•í˜„ì§„", cohort: "04" },
      { name: "ì†¡ì˜ˆì¤€", cohort: "00" },
      { name: "ì†¡ìš©ì„", cohort: "02" },
      { name: "ì´í•˜ì¤€", cohort: "07" },
      { name: "ì´í•œì—´", cohort: "04" },
      { name: "ì´íœ˜ìˆ˜", cohort: "00" },
      { name: "ì¥ì„ë¯¼", cohort: "00" },
      { name: "ì •ì˜ˆì€a", cohort: "07" },
      { name: "ì¡°ì¤€ì„œ", cohort: "01" },
      { name: "ìµœìœ¤ìˆ˜", cohort: "99" }
    ]
  },
  {
    id: 11,
    name: "í•˜ì¬ì˜ ì‚¬ë‘ë°©",
    leader: "ë°©ì¥: í•˜ì¬ì˜",
    members: [
      { name: "í•˜ì¬ì˜", cohort: "00" },
      { name: "ê¶Œì‹œí›ˆ", cohort: "03" },
      { name: "ê¹€ì‹œì˜¨", cohort: "03" },
      { name: "ê¹€ìœ ë‚˜", cohort: "02" },
      { name: "ê¹€ì€ì¤€", cohort: "00" },
      { name: "ê¹€ì£¼ì˜", cohort: "07" },
      { name: "ê¹€í•´ë¦¼", cohort: "07" },
      { name: "ë‚¨í›ˆ", cohort: "06" },
      { name: "ë¥˜ì˜ë¯¼", cohort: "02" },
      { name: "ì†ì˜ì§€", cohort: "07" },
      { name: "ì†¡ê°€ì€", cohort: "07" },
      { name: "ì†¡ìŠ¹ìš°", cohort: "05" },
      { name: "ì´ì •í•œ", cohort: "02" },
      { name: "ì´í•œì†”", cohort: "07" },
      { name: "ì„ì§€ë¯¼", cohort: "07" },
      { name: "ì¥í•˜ì„œ", cohort: "02" },
      { name: "ì¡°ì‹œì˜", cohort: "07" },
      { name: "í™©ì¬ìœ¤", cohort: "01" }
    ]
  },
  {
    id: 12,
    name: "WeeíŒ€",
    leader: "ë°©ì¥: ê¶Œí•˜ê²½, ìµœìˆ˜ì¸",
    members: [
      { name: "ê¶Œí•˜ê²½", cohort: "03" },
      { name: "ìµœìˆ˜ì¸", cohort: "98" },
      { name: "ê³ ë³´ë¯¼", cohort: "05" },
      { name: "ê¹€ë¯¼ì§€", cohort: "99" },
      { name: "ì˜¤í•˜ì§„", cohort: "05" },
      { name: "ìœ ì˜ˆí¬", cohort: "04" },
      { name: "ìœ ìš”í•œ", cohort: "03" },
      { name: "ì¥ì„ë²”", cohort: "98" }
    ]
  }
];

    const TEAM_PASSWORDS = { 1: "7053", 2: "2580", 3: "0726", 4: "1111", 5: "1218", 6: "4884", 7: "2005", 8: "8888", 9: "1015", 10: "9804", 11: "0831", 12: "1212" };
    const ADMIN_PASSWORD = "6789";

    let selectedTeam = null;
    let attendance = {};
    let memberNotes = {};
    let adminAuthed = false;
    let chartInstance = null;

    // ê³µí†µ í•¨ìˆ˜
    function normalizeCohort(v) {
      let s = (v || "").toString().replace(/'/g, "").trim();
      if (/^\d$/.test(s)) s = "0" + s;
      return s;
    }

    function showPage(pageId) {
      document.getElementById("homePage").classList.add("hidden");
      document.getElementById("attendancePage").classList.add("hidden");
      document.getElementById("adminDashboard").classList.add("hidden");
      document.getElementById(pageId).classList.remove("hidden");
    }

    function showMsg(type, text) {
      const box = document.getElementById("messageBox");
      box.className = "message " + type;
      box.textContent = text;
      box.classList.remove("hidden");
      setTimeout(() => box.classList.add("hidden"), 3000);
    }

    function jsonp(url, params) {
      return new Promise((resolve, reject) => {
        const callbackName = "cb_" + Date.now() + Math.floor(Math.random() * 1000);
        params.callback = callbackName;
        const queryString = Object.keys(params).map(k => encodeURIComponent(k) + "=" + encodeURIComponent(params[k])).join("&");
        const script = document.createElement("script");
        script.src = url + "?" + queryString;
        window[callbackName] = (data) => {
          delete window[callbackName];
          document.body.removeChild(script);
          resolve(data);
        };
        script.onerror = () => {
          delete window[callbackName];
          if (script.parentNode) document.body.removeChild(script);
          reject(new Error("JSONP request failed"));
        };
        document.body.appendChild(script);
      });
    }

    // ë©”ì¸ í™ˆ ì´ˆê¸°í™”
    const todayStr = new Date().toISOString().split("T")[0];
    document.getElementById("dateInput").value = todayStr;

    const teamGrid = document.getElementById("teamGrid");
    TEAMS.forEach(team => {
      const card = document.createElement("div");
      card.className = "team-card";
      card.innerHTML = `
        <div class="team-card-header">
          <div class="team-number">${team.id}</div>
          <div class="member-count">${team.members.length}ëª…</div>
        </div>
        <div class="team-name">${team.name}</div>
        <div class="team-leader">${team.leader}</div>
      `;
      card.onclick = () => openPasswordModal("team", team);
      teamGrid.appendChild(card);
    });

    // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë¡œì§
    const modalState = { type: null, data: null };
    function openPasswordModal(type, data) {
      modalState.type = type;
      modalState.data = data;
      document.getElementById("passwordModal").classList.remove("hidden");
      document.getElementById("modalPassword").value = "";
      document.getElementById("modalError").classList.add("hidden");
      document.getElementById("modalSubtitle").textContent = type === "admin" ? "ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì ‘ì†" : data.name;
      document.getElementById("modalPassword").focus();
    }

    document.getElementById("modalOkBtn").onclick = checkPassword;
    document.getElementById("modalPassword").onkeydown = (e) => { if (e.key === "Enter") checkPassword(); };
    document.getElementById("modalCancelBtn").onclick = () => document.getElementById("passwordModal").classList.add("hidden");

    function checkPassword() {
      const input = document.getElementById("modalPassword").value;
      if (modalState.type === "admin") {
        if (input === ADMIN_PASSWORD) {
          adminAuthed = true;
          document.getElementById("passwordModal").classList.add("hidden");
          showAdminDashboard();
        } else {
          document.getElementById("modalError").classList.remove("hidden");
        }
      } else {
        if (input === TEAM_PASSWORDS[modalState.data.id]) {
          document.getElementById("passwordModal").classList.add("hidden");
          loadTeamPage(modalState.data);
        } else {
          document.getElementById("modalError").classList.remove("hidden");
        }
      }
    }

    // ì¶œì„ì²´í¬ í˜ì´ì§€ ë¡œë“œ
    function loadTeamPage(team) {
      selectedTeam = team;
      document.getElementById("selectedTeamName").textContent = team.name;
      document.getElementById("selectedTeamLeader").textContent = team.leader;
      showPage("attendancePage");

      attendance = {};
      memberNotes = {};
      const list = document.getElementById("memberList");
      list.innerHTML = "";

      team.members.forEach(m => {
        const key = m.name.trim() + "||" + normalizeCohort(m.cohort);
        attendance[key] = false;
        
        const el = document.createElement("div");
        el.className = "member-item";
        el.dataset.key = key;
        el.innerHTML = `
          <div class="member-header">
            <div>
              <div class="member-name">${m.name}</div>
              <div class="member-meta">${m.cohort} ë˜ë˜</div>
            </div>
            <div class="checkbox"><span class="checkmark">âœ“</span></div>
          </div>
          <input type="text" class="note-input" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥" oninput="memberNotes['${key}']=this.value" onclick="event.stopPropagation()">
        `;
        el.onclick = (e) => {
          if (e.target.tagName === "INPUT") return;
          attendance[key] = !attendance[key];
          el.classList.toggle("checked", attendance[key]);
          updateUI();
        };
        list.appendChild(el);
      });
      loadServerAttendance();
    }

    function updateUI() {
      const total = Object.keys(attendance).length;
      const present = Object.values(attendance).filter(v => v === true).length;
      document.getElementById("attendanceCount").textContent = `${present} / ${total}`;
      document.getElementById("progressFill").style.width = total > 0 ? (present / total * 100) + "%" : "0%";
    }

    async function loadServerAttendance() {
      showMsg("info", "ì´ì „ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
      try {
        const dateVal = document.getElementById("dateInput").value;
        const res = await jsonp(GOOGLE_SCRIPT_URL, {
          action: "loadAttendance",
          teamId: selectedTeam.id,
          date: dateVal
        });

        // ì´ˆê¸°í™”
        document.querySelectorAll(".member-item").forEach(el => {
          const k = el.dataset.key;
          attendance[k] = false;
          el.classList.remove("checked");
          el.querySelector("input").value = "";
          memberNotes[k] = "";
        });
        document.getElementById("suggestionInput").value = "";

        if (res.status === "success" && res.data.found) {
          res.data.attendance.forEach(row => {
            const k = row.name.trim() + "||" + normalizeCohort(row.cohort);
            if (attendance.hasOwnProperty(k)) {
              attendance[k] = row.isPresent;
              memberNotes[k] = row.note || "";
              const itemEl = document.querySelector(`.member-item[data-key="${k.replace(/([ #;?%&,.+*~\':"!^$[\]()=>|/@])/g, '\\$1')}"]`);
              if (itemEl) {
                if (row.isPresent) itemEl.classList.add("checked");
                itemEl.querySelector("input").value = row.note || "";
              }
            }
          });
          document.getElementById("suggestionInput").value = res.data.suggestion || "";
          showMsg("success", "ê¸°ì¡´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
        } else {
          showMsg("info", "í•´ë‹¹ ë‚ ì§œì˜ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
        }
        updateUI();
      } catch (e) {
        showMsg("error", "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      }
    }

    document.getElementById("saveBtn").onclick = async () => {
      const btn = document.getElementById("saveBtn");
      btn.textContent = "ì €ì¥ ì¤‘...";
      btn.disabled = true;

      const dateVal = document.getElementById("dateInput").value;
      const attendanceList = Object.keys(attendance).map(k => ({
        name: k.split("||")[0],
        cohort: k.split("||")[1],
        isPresent: attendance[k],
        note: memberNotes[k] || ""
      }));

      const payload = {
        action: "saveAttendance",
        teamId: selectedTeam.id,
        teamName: selectedTeam.name,
        leader: selectedTeam.leader,
        date: dateVal,
        suggestion: document.getElementById("suggestionInput").value,
        attendance: attendanceList
      };

      try {
        await fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(payload)
        });
        showMsg("success", "ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      } catch (e) {
        showMsg("error", "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      } finally {
        btn.textContent = "ì¶œì„ ì •ë³´ ì €ì¥í•˜ê¸°";
        btn.disabled = false;
      }
    };

    document.getElementById("forceLoadBtn").onclick = loadServerAttendance;
    document.getElementById("dateInput").onchange = loadServerAttendance;
    document.getElementById("teamBackBtn").onclick = () => showPage("homePage");

    document.getElementById("memberSearch").oninput = (e) => {
      const val = e.target.value.toLowerCase();
      document.querySelectorAll(".member-item").forEach(el => {
        const name = el.dataset.key.split("||")[0].toLowerCase();
        el.style.display = name.includes(val) ? "" : "none";
      });
    };

    // --- ê´€ë¦¬ì ê¸°ëŠ¥ ---
    document.getElementById("adminBtn").onclick = () => {
      if (adminAuthed) showAdminDashboard();
      else openPasswordModal("admin");
    };
    document.getElementById("adminBackBtn").onclick = () => {
      adminAuthed = false;
      showPage("homePage");
    };

    function showAdminDashboard() {
      showPage("adminDashboard");
      const adToday = new Date().toISOString().split("T")[0];
      if (!document.getElementById("adminDateInput").value) document.getElementById("adminDateInput").value = adToday;
      if (!document.getElementById("adminNotesDateInput").value) document.getElementById("adminNotesDateInput").value = adToday;
      if (!document.getElementById("adminSuggestionsDateInput").value) document.getElementById("adminSuggestionsDateInput").value = adToday;
      if (!document.getElementById("memberStartDate").value) document.getElementById("memberStartDate").value = adToday;
      if (!document.getElementById("memberEndDate").value) document.getElementById("memberEndDate").value = adToday;

      refreshAdminStats();
      loadMemberListForAdmin();
    }

    // ê´€ë¦¬ì íƒ­ ì „í™˜ ë¡œì§ (ì›ë³¸ ì™„ë²½ ë³µêµ¬)
    document.querySelectorAll(".tab-button").forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const targetTab = btn.dataset.tab;
        document.getElementById("adminStatsTab").classList.add("hidden");
        document.getElementById("adminNotesTab").classList.add("hidden");
        document.getElementById("adminSuggestionsTab").classList.add("hidden");
        document.getElementById("adminMembersTab").classList.add("hidden");

        if (targetTab === "stats") {
          document.getElementById("adminStatsTab").classList.remove("hidden");
          refreshAdminStats();
        } else if (targetTab === "notes") {
          document.getElementById("adminNotesTab").classList.remove("hidden");
          refreshAdminNotes();
        } else if (targetTab === "suggestions") {
          document.getElementById("adminSuggestionsTab").classList.remove("hidden");
          refreshAdminSuggestions();
        } else if (targetTab === "members") {
          document.getElementById("adminMembersTab").classList.remove("hidden");
        }
      };
    });

    // ì¶œì„ í˜„í™© í…Œì´ë¸” ë° ìƒì„¸ í† ê¸€
    async function refreshAdminStats() {
      const dateVal = document.getElementById("adminDateInput").value;
      const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getStatsByDate", date: dateVal });
      
      let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ì¶œì„</th><th>ê²°ì„</th><th>ì¶œì„ë¥ </th></tr></thead><tbody>`;
      TEAMS.forEach(t => {
        const stats = res.data.teamStats.find(x => String(x.teamId) === String(t.id)) || { present: 0, absent: 0 };
        const total = stats.present + stats.absent;
        const rate = total > 0 ? ((stats.present / total) * 100).toFixed(1) : "0";
        html += `
          <tr style="cursor:pointer" onclick="toggleDetail('${t.id}')">
            <td>${t.name}</td>
            <td>${stats.present}</td>
            <td>${stats.absent}</td>
            <td>${rate}%</td>
          </tr>
          <tr id="detail-${t.id}" class="hidden">
            <td colspan="4" style="background:#f9fafb; padding:15px; border-bottom:1px solid #e5e7eb;" id="content-${t.id}">ë¡œë”© ì¤‘...</td>
          </tr>
        `;
      });
      html += `</tbody></table>`;
      document.getElementById("attendanceTable").innerHTML = html;
    }

    window.toggleDetail = async (teamId) => {
      const row = document.getElementById(`detail-${teamId}`);
      if (!row.classList.contains("hidden")) {
        row.classList.add("hidden");
        return;
      }
      row.classList.remove("hidden");
      const content = document.getElementById(`content-${teamId}`);
      const dateVal = document.getElementById("adminDateInput").value;

      try {
        const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "loadAttendance", teamId: teamId, date: dateVal });
        if (!res.data.found) {
          content.innerHTML = "ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }
        const presentNames = res.data.attendance.filter(a => a.isPresent).map(a => `<span style="display:inline-block; background:#dbeafe; color:#2563eb; padding:2px 8px; border-radius:15px; margin:2px; font-size:0.8rem;">${a.name}</span>`).join("");
        const absentNames = res.data.attendance.filter(a => !a.isPresent).map(a => `<span style="display:inline-block; background:#fee2e2; color:#b91c1c; padding:2px 8px; border-radius:15px; margin:2px; font-size:0.8rem;">${a.name}</span>`).join("");
        content.innerHTML = `
          <div style="margin-bottom:8px;"><strong>ì¶œì„:</strong> ${presentNames || "ì—†ìŒ"}</div>
          <div><strong>ê²°ì„:</strong> ${absentNames || "ì—†ìŒ"}</div>
        `;
      } catch (e) { content.innerHTML = "ì˜¤ë¥˜ ë°œìƒ"; }
    };

    async function refreshAdminNotes() {
      const dateVal = document.getElementById("adminNotesDateInput").value;
      const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getNotesByDate", date: dateVal });
      let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ì´ë¦„</th><th>ë‚´ìš©</th></tr></thead><tbody>`;
      if (res.data.length === 0) html += `<tr><td colspan="3" style="text-align:center; color:#9ca3af;">íŠ¹ì´ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      res.data.forEach(n => {
        html += `<tr><td>${n.teamName}</td><td>${n.name}(${n.cohort})</td><td>${n.note}</td></tr>`;
      });
      document.getElementById("notesTable").innerHTML = html + "</tbody></table>";
    }

    async function refreshAdminSuggestions() {
      const dateVal = document.getElementById("adminSuggestionsDateInput").value;
      const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getSuggestionsByDate", date: dateVal });
      let html = `<table><thead><tr><th>ì‚¬ë‘ë°©</th><th>ê±´ì˜ì‚¬í•­</th></tr></thead><tbody>`;
      if (res.data.length === 0) html += `<tr><td colspan="2" style="text-align:center; color:#9ca3af;">ê±´ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      res.data.forEach(s => {
        html += `<tr><td>${s.teamName}</td><td>${s.suggestion}</td></tr>`;
      });
      document.getElementById("suggestionsTable").innerHTML = html + "</tbody></table>";
    }

    async function loadMemberListForAdmin() {
      const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getAllMembers" });
      const sel = document.getElementById("memberSelect");
      sel.innerHTML = `<option value="">ë°©ì› ì„ íƒ</option>`;
      res.data.forEach(m => {
        sel.innerHTML += `<option value="${m.name}||${m.cohort}">${m.name} (${m.cohort} ë˜ë˜)</option>`;
      });
    }

    document.getElementById("memberSelect").onchange = async () => {
      const val = document.getElementById("memberSelect").value;
      if (!val) return;
      const [name, cohort] = val.split("||");
      const start = document.getElementById("memberStartDate").value;
      const end = document.getElementById("memberEndDate").value;

      const res = await jsonp(GOOGLE_SCRIPT_URL, { action: "getMemberHistory", name, cohort, startDate: start, endDate: end });
      document.getElementById("memberResultArea").classList.remove("hidden");
      renderChart(res.data.monthly);

      let html = `<table><thead><tr><th>ë‚ ì§œ</th><th>ì‚¬ë‘ë°©</th><th>ì¶œì„</th></tr></thead><tbody>`;
      res.data.sessions.forEach(s => {
        html += `<tr><td>${s.date}</td><td>${s.teamName}</td><td>${s.isPresent ? "âœ…" : "âŒ"}</td></tr>`;
      });
      document.getElementById("memberHistoryTable").innerHTML = html + "</tbody></table>";
    };

    function renderChart(monthlyData) {
      const ctx = document.getElementById('memberChart').getContext('2d');
      if (chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: monthlyData.map(d => d.month),
          datasets: [{
            label: 'ì›”ë³„ ì¶œì„ë¥  (%)',
            data: monthlyData.map(d => parseFloat(d.rate)),
            backgroundColor: '#3b82f6',
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true, max: 100 } }
        }
      });
    }

    document.getElementById("saveToSheetBtn").onclick = async () => {
      const btn = document.getElementById("saveToSheetBtn");
      const startDate = document.getElementById("memberStartDate").value;
      const endDate = document.getElementById("memberEndDate").value;
      
      if (!startDate || !endDate) {
        alert("ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }
      
      // êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ì„ ìœ„í•œ ISO í˜•ì‹ ë³€í™˜
      const isoStart = new Date(startDate).toISOString();
      const isoEnd = new Date(endDate).toISOString();

      if (!confirm(`${startDate}ë¶€í„° ${endDate}ê¹Œì§€ì˜ í†µê³„ë¥¼\nêµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ìƒˆ íƒ­ìœ¼ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

      btn.disabled = true;
      btn.textContent = "ì €ì¥ ì¤‘... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)";
      
      try {
        const res = await jsonp(GOOGLE_SCRIPT_URL, { 
          action: "saveSummaryToSheet", 
          startDate: isoStart, 
          endDate: isoEnd 
        });
        
        if (res.status === "success") {
          alert("ì„±ê³µ!\n" + res.message);
        } else {
          alert("ì˜¤ë¥˜ ë°œìƒ: " + res.message);
        }
      } catch (e) {
        alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ê¶Œí•œ ë¬¸ì œë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      } finally {
        btn.disabled = false;
        btn.textContent = "ğŸ“Š í†µê³„ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì €ì¥";
      }
    };

    ["adminDateInput", "adminNotesDateInput", "adminSuggestionsDateInput"].forEach(id => {
      document.getElementById(id).onchange = () => {
        if (id === "adminDateInput") refreshAdminStats();
        else if (id === "adminNotesDateInput") refreshAdminNotes();
        else refreshAdminSuggestions();
      };
    });
  </script>
</body>
</html>
